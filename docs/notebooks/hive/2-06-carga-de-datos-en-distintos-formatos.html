

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Carga de datos en distintos formatos &mdash; documentación de --- Cursos --- - </title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="Manejo de Datos Complejos y Tablas Particionadas" href="2-07-manejo-de-datos-complejos.html" />
    <link rel="prev" title="Transacciones ACID (Insert/ Update / Delete) en Hive" href="2-05-transacciones-acid.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../analitica-de-grandes-datos/content.html">Sesiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/grades.html">Laboratorios de Programación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/course-info.html">Información del curso</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/content.html">Sesiones</a> &raquo;</li>
        
      <li>Carga de datos en distintos formatos</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/hive/2-06-carga-de-datos-en-distintos-formatos.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Carga-de-datos-en-distintos-formatos">
<h1>Carga de datos en distintos formatos<a class="headerlink" href="#Carga-de-datos-en-distintos-formatos" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li><p><em>30 min</em> | Última modificación: Junio 22, 2019</p></li>
</ul>
<p>Hive permite la lectura de archivos en distintos formatos. Al finalizar este tutorial, el lector estará en capacidad de leer archivos en formatos de texto, CSV y JSON.</p>
<div class="section" id="Ejecución-de-Hive-en-un-contenedor-de-Docker">
<h2>Ejecución de Hive en un contenedor de Docker<a class="headerlink" href="#Ejecución-de-Hive-en-un-contenedor-de-Docker" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li><p>Usando el directorio de trabajo de la máquina local:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;$PWD&quot;</span><span class="p">:</span><span class="o">/</span><span class="n">datalake</span>  <span class="o">--</span><span class="n">name</span> <span class="n">hive</span> <span class="o">-</span><span class="n">p</span> <span class="mi">50070</span><span class="p">:</span><span class="mi">50070</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8088</span><span class="p">:</span><span class="mi">8088</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">8888</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="n">jdvelasq</span><span class="o">/</span><span class="n">hive</span><span class="p">:</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">6</span><span class="o">-</span><span class="n">pseudo</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Usando un volumen de Docker (llamado <code class="docutils literal notranslate"><span class="pre">datalake</span></code>):</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">v</span> <span class="n">datalake</span><span class="p">:</span><span class="o">/</span><span class="n">datalake</span> <span class="o">--</span><span class="n">name</span> <span class="n">hive</span>  <span class="o">-</span><span class="n">p</span> <span class="mi">50070</span><span class="p">:</span><span class="mi">50070</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8088</span><span class="p">:</span><span class="mi">8088</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">8888</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="n">jdvelasq</span><span class="o">/</span><span class="n">hive</span><span class="p">:</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">6</span><span class="o">-</span><span class="n">pseudo</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Consola conectada a un contendor que ya está corriendo:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">hive</span> <span class="n">bash</span>
</pre></div>
</div>
</div>
<div class="section" id="Preparación">
<h2>Preparación<a class="headerlink" href="#Preparación" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se carga la librería para interactuar con Hive desde Jupyter.</span>
<span class="c1">##</span>
<span class="o">%</span><span class="k">load_ext</span> bigdata
<span class="o">%</span><span class="k">timeout</span> 300
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Crea la carpeta drivers en el HDFS</span>
<span class="c1">##</span>
<span class="o">!</span>hdfs dfs -rm -r -f /tmp/drivers
<span class="o">!</span>hdfs dfs -mkdir    /tmp/drivers
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Deleted /tmp/drivers
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>apt-get update <span class="o">&amp;&amp;</span> apt-get install wget
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hit:1 https://deb.nodesource.com/node_13.x bionic InRelease
Hit:2 http://security.ubuntu.com/ubuntu bionic-security InRelease
Hit:3 http://archive.ubuntu.com/ubuntu bionic InRelease
Hit:4 http://archive.ubuntu.com/ubuntu bionic-updates InRelease
Hit:5 http://archive.ubuntu.com/ubuntu bionic-backports InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree
Reading state information... Done
wget is already the newest version (1.19.4-1ubuntu2.2).
0 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>wget https://raw.githubusercontent.com/jdvelasq/datalabs/master/datasets/drivers/drivers.csv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2019-11-08 11:53:13--  https://raw.githubusercontent.com/jdvelasq/datalabs/master/datasets/drivers/drivers.csv
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 199.232.48.133
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|199.232.48.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2043 (2.0K) [text/plain]
Saving to: &#39;drivers.csv&#39;

drivers.csv         100%[===================&gt;]   2.00K  --.-KB/s    in 0.001s

2019-11-08 11:53:13 (1.48 MB/s) - &#39;drivers.csv&#39; saved [2043/2043]

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>wget https://raw.githubusercontent.com/jdvelasq/datalabs/master/datasets/drivers/drivers.json
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2019-11-08 11:53:14--  https://raw.githubusercontent.com/jdvelasq/datalabs/master/datasets/drivers/drivers.json
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 199.232.48.133
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|199.232.48.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4308 (4.2K) [text/plain]
Saving to: &#39;drivers.json&#39;

drivers.json        100%[===================&gt;]   4.21K  --.-KB/s    in 0.001s

2019-11-08 11:53:14 (3.95 MB/s) - &#39;drivers.json&#39; saved [4308/4308]

</pre></div></div>
</div>
</div>
<div class="section" id="Lectura-de-formato-JSON-desde-un-archivo-cargado-como-texto">
<h2>Lectura de formato JSON desde un archivo cargado como texto<a class="headerlink" href="#Lectura-de-formato-JSON-desde-un-archivo-cargado-como-texto" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En esta estrategía de carga de datos, el archivo original con formato JSON es cargado como texto, donde cada registro de la tabla corresponde a una línea del archivo original.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Copia el archivo al HDFS para su importación posterior a Hive</span>
<span class="c1">##</span>
<span class="o">!</span>hdfs dfs -copyFromLocal drivers.json  /tmp/drivers/
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>hdfs dfs -ls /tmp/drivers/
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 1 items
-rw-r--r--   1 root supergroup       4308 2019-11-08 11:53 /tmp/drivers/drivers.json
</pre></div></div>
</div>
<p>En la siguiente celda, se crea la tabla <code class="docutils literal notranslate"><span class="pre">drivers_raw_json</span></code>, la cual tiene una única columna llamada <code class="docutils literal notranslate"><span class="pre">textcol</span></code>. Luego, el archivo <code class="docutils literal notranslate"><span class="pre">drivers.json</span></code> es cargado en dicha tabla. Finalmente, se visualizan los primeros cinco registros para verificar que la lectura fue correcta.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">hive</span>
DROP TABLE IF EXISTS drivers_raw_json;

CREATE TABLE drivers_raw_json (
    textcol STRING
)
STORED AS TEXTFILE;

LOAD DATA INPATH
    &#39;/tmp/drivers/drivers.json&#39;
OVERWRITE INTO TABLE drivers_raw_json;

SELECT * FROM drivers_raw_json LIMIT 5;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DROP TABLE IF EXISTS drivers_raw_json;
OK
Time taken: 7.144 seconds
CREATE TABLE drivers_raw_json (
    textcol STRING
)
STORED AS TEXTFILE;
OK
Time taken: 0.966 seconds
LOAD DATA INPATH
    &#39;/tmp/drivers/drivers.json&#39;
OVERWRITE INTO TABLE drivers_raw_json;
Loading data to table default.drivers_raw_json
OK
Time taken: 0.893 seconds
SELECT * FROM drivers_raw_json LIMIT 5;
OK
{&#34;driverId&#34;:10,&#34;name&#34;:&#34;George Vetticaden&#34;,&#34;ssn&#34;:621011971,&#34;location&#34;:&#34;244-4532 Nulla Rd.&#34;,&#34;certified&#34;:&#34;N&#34;,&#34;wage-plan&#34;:&#34;miles&#34;}
{&#34;driverId&#34;:11,&#34;name&#34;:&#34;Jamie Engesser&#34;,&#34;ssn&#34;:262112338,&#34;location&#34;:&#34;366-4125 Ac Street&#34;,&#34;certified&#34;:&#34;N&#34;,&#34;wage-plan&#34;:&#34;miles&#34;}
{&#34;driverId&#34;:12,&#34;name&#34;:&#34;Paul Coddin&#34;,&#34;ssn&#34;:198041975,&#34;location&#34;:&#34;Ap #622-957 Risus. Street&#34;,&#34;certified&#34;:&#34;Y&#34;,&#34;wage-plan&#34;:&#34;hours&#34;}
{&#34;driverId&#34;:13,&#34;name&#34;:&#34;Joe Niemiec&#34;,&#34;ssn&#34;:139907145,&#34;location&#34;:&#34;2071 Hendrerit. Ave&#34;,&#34;certified&#34;:&#34;Y&#34;,&#34;wage-plan&#34;:&#34;hours&#34;}
{&#34;driverId&#34;:14,&#34;name&#34;:&#34;Adis Cesir&#34;,&#34;ssn&#34;:820812209,&#34;location&#34;:&#34;Ap #810-1228 In St.&#34;,&#34;certified&#34;:&#34;Y&#34;,&#34;wage-plan&#34;:&#34;hours&#34;}
Time taken: 2.372 seconds, Fetched: 5 row(s)
</pre></div></div>
</div>
<p>Note que en la salida anterior, cada fila corresponde a un registro.</p>
<div class="section" id="Lectura-usando-get_json_object">
<h3>Lectura usando get_json_object<a class="headerlink" href="#Lectura-usando-get_json_object" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los valores de los campos pueden ser extraídos usando la función <code class="docutils literal notranslate"><span class="pre">get_json_object</span></code>, cuyos parámetros son el nombre del campo en la tabla y el nombre del campo en la estructura JSON. En el siguiente fragmento de código, se utiliza una consulta para extraer los campos <code class="docutils literal notranslate"><span class="pre">driverId</span></code>, <code class="docutils literal notranslate"><span class="pre">name</span></code> y <code class="docutils literal notranslate"><span class="pre">ssn</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">hive</span>
SELECT
    GET_JSON_OBJECT(textcol,&#39;$.driverId&#39;),
    GET_JSON_OBJECT(textcol,&#39;$.name&#39;),
    GET_JSON_OBJECT(textcol,&#39;$.ssn&#39;)
FROM
    drivers_raw_json
LIMIT
    10;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SELECT
    GET_JSON_OBJECT(textcol,&#39;$.driverId&#39;),
    GET_JSON_OBJECT(textcol,&#39;$.name&#39;),
    GET_JSON_OBJECT(textcol,&#39;$.ssn&#39;)
FROM
    drivers_raw_json
LIMIT
    10;
OK
10      George Vetticaden       621011971
11      Jamie Engesser  262112338
12      Paul Coddin     198041975
13      Joe Niemiec     139907145
14      Adis Cesir      820812209
15      Rohit Bakshi    239005227
16      Tom McCuch      363303105
17      Eric Mizell     123808238
18      Grant Liu       171010151
19      Ajay Singh      160005158
Time taken: 0.657 seconds, Fetched: 10 row(s)
</pre></div></div>
</div>
</div>
<div class="section" id="Uso-de-json_tuple">
<h3>Uso de json_tuple<a class="headerlink" href="#Uso-de-json_tuple" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Esta función cumple el mismo objetivo de la anterior, pero es mucho más eficiente ya que el registro es procesado únicamente una vez para realizar la extracción de la información requerida. Ya que <code class="docutils literal notranslate"><span class="pre">json_tuple</span></code> es una UDF, debe usarse <code class="docutils literal notranslate"><span class="pre">LATERAL</span> <span class="pre">VIEW</span></code> para realizar la consulta, tal como se ejemplifica a continuación.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">hive</span>
SELECT
    t1.driverId,
    t1.name,
    t1.ssn
FROM
    drivers_raw_json  t0
LATERAL VIEW
    JSON_TUPLE(t0.textcol, &#39;driverId&#39;, &#39;name&#39;, &#39;ssn&#39;) t1
    AS driverId, name, ssn
LIMIT 5;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SELECT
    t1.driverId,
    t1.name,
    t1.ssn
FROM
    drivers_raw_json  t0
LATERAL VIEW
    JSON_TUPLE(t0.textcol, &#39;driverId&#39;, &#39;name&#39;, &#39;ssn&#39;) t1
    AS driverId, name, ssn
LIMIT 5;
OK
10      George Vetticaden       621011971
11      Jamie Engesser  262112338
12      Paul Coddin     198041975
13      Joe Niemiec     139907145
14      Adis Cesir      820812209
Time taken: 0.106 seconds, Fetched: 5 row(s)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Carga-de-archivos-en-formato-JSON">
<h2>Carga de archivos en formato JSON<a class="headerlink" href="#Carga-de-archivos-en-formato-JSON" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Hive también permite la importación directa de archivos en formato JSON usando el serde <code class="docutils literal notranslate"><span class="pre">JsonSerDe</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se copia el archivo al sistema HDFS</span>
<span class="c1">##</span>
<span class="o">!</span>hdfs dfs -copyFromLocal drivers.*  /tmp/drivers/
</pre></div>
</div>
</div>
<p>En la siguiente celda, se crea la tabla <code class="docutils literal notranslate"><span class="pre">drivers_json</span></code> donde el formato de cada registro es especificado como JSON</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">hive</span>
DROP TABLE IF EXISTS drivers_json;

CREATE TABLE drivers_json (
    driverId  INT,
    name      STRING,
    ssn       BIGINT,
    location  STRING,
    certified STRING,
    wageplan  STRING)
ROW FORMAT SERDE &#39;org.apache.hive.hcatalog.data.JsonSerDe&#39;
STORED AS TEXTFILE
LOCATION &#39;/tmp/drivers-json&#39;;

LOAD DATA INPATH &#39;/tmp/drivers/drivers.json&#39; OVERWRITE INTO TABLE drivers_json;

SELECT * FROM drivers_json LIMIT 5;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DROP TABLE IF EXISTS drivers_json;
OK
Time taken: 0.121 seconds
CREATE TABLE drivers_json (
    driverId  INT,
    name      STRING,
    ssn       BIGINT,
    location  STRING,
    certified STRING,
    wageplan  STRING)
ROW FORMAT SERDE &#39;org.apache.hive.hcatalog.data.JsonSerDe&#39;
STORED AS TEXTFILE
LOCATION &#39;/tmp/drivers-json&#39;;
OK
Time taken: 0.099 seconds
json;DATA INPATH &#39;/tmp/drivers/drivers.json&#39; OVERWRITE INTO TABLE drivers_
Loading data to table default.drivers_json
OK
Time taken: 0.436 seconds
SELECT * FROM drivers_json LIMIT 5;
OK
10      George Vetticaden       621011971       244-4532 Nulla Rd.      N       NULL
11      Jamie Engesser  262112338       366-4125 Ac Street      N       NULL
12      Paul Coddin     198041975       Ap #622-957 Risus. Street       Y       NULL
13      Joe Niemiec     139907145       2071 Hendrerit. Ave     Y       NULL
14      Adis Cesir      820812209       Ap #810-1228 In St.     Y       NULL
Time taken: 0.154 seconds, Fetched: 5 row(s)
</pre></div></div>
</div>
</div>
<div class="section" id="Carga-de-archivos-en-formato-CSV">
<h2>Carga de archivos en formato CSV<a class="headerlink" href="#Carga-de-archivos-en-formato-CSV" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En este ejemplo se usa el serde <code class="docutils literal notranslate"><span class="pre">OpenCSVSerde</span></code> para leer archivo en formato CSV. Note que se usa la cláusula <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">serdeproperties</span></code> para indicar las características del formato CSV utilizado.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">hive</span>
DROP TABLE IF EXISTS drivers_csv;

CREATE TABLE drivers_csv (driverId  INT,
                         name      STRING,
                         ssn       BIGINT,
                         location  STRING,
                         certified STRING,
                         wageplan  STRING)
ROW FORMAT SERDE
    &#39;org.apache.hadoop.hive.serde2.OpenCSVSerde&#39;
WITH SERDEPROPERTIES (
   &#39;separatorChar&#39; = &quot;,&quot;,
   &#39;quoteChar&#39;     = &#39;\&#39;&#39;,
   &#39;escapeChar&#39;    = &quot;\\&quot;);

LOAD DATA INPATH &#39;/tmp/drivers/drivers.csv&#39; OVERWRITE INTO TABLE drivers_csv;

SELECT * FROM drivers_csv LIMIT 5;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DROP TABLE IF EXISTS drivers_csv;
OK
Time taken: 0.096 seconds
CREATE TABLE drivers_csv (driverId  INT,
                         name      STRING,
                         ssn       BIGINT,
                         location  STRING,
                         certified STRING,
                         wageplan  STRING)
ROW FORMAT SERDE
    &#39;org.apache.hadoop.hive.serde2.OpenCSVSerde&#39;
WITH SERDEPROPERTIES (
   &#39;separatorChar&#39; = &#34;,&#34;,
   &#39;quoteChar&#39;     = &#39;\&#39;&#39;,
   &#39;escapeChar&#39;    = &#34;\\&#34;);
OK
Time taken: 0.074 seconds
sv;D DATA INPATH &#39;/tmp/drivers/drivers.csv&#39; OVERWRITE INTO TABLE drivers_c
Loading data to table default.drivers_csv
OK
Time taken: 0.425 seconds
SELECT * FROM drivers_csv LIMIT 5;
OK
driverId        name    ssn     location        certified       wage-plan
10      George Vetticaden       621011971       244-4532 Nulla Rd.      N       miles
11      Jamie Engesser  262112338       366-4125 Ac Street      N       miles
12      Paul Coddin     198041975       Ap #622-957 Risus. Street       Y       hours
13      Joe Niemiec     139907145       2071 Hendrerit. Ave     Y       hours
Time taken: 0.158 seconds, Fetched: 5 row(s)
</pre></div></div>
</div>
</div>
<div class="section" id="Carga-usando-expresiones-regulaes-y-RegexSerDe">
<h2>Carga usando expresiones regulaes y RegexSerDe<a class="headerlink" href="#Carga-usando-expresiones-regulaes-y-RegexSerDe" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En este caso, se realiza la carga de datos especificando los campos mediante el uso de expresiones regulares.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Copia los archivos al HDFS</span>
<span class="c1">##</span>
<span class="o">!</span>hdfs dfs -copyFromLocal drivers.csv  /tmp/drivers/
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">hive</span>
DROP TABLE IF EXISTS drivers_regex;

CREATE TABLE drivers_regex(
    driverId  INT,
    name      STRING,
    ssn       BIGINT,
    location  STRING,
    certified STRING,
    wageplan  STRING)
ROW FORMAT SERDE
    &#39;org.apache.hadoop.hive.serde2.RegexSerDe&#39;
WITH SERDEPROPERTIES (
   &#39;input.regex&#39; = &#39;(\\d+),([^,]*),(\\d+),([^,]*),([^,]*),([^,]*)&#39;)
TBLPROPERTIES (&quot;skip.header.line.count&quot;=&quot;1&quot;);

LOAD DATA INPATH &#39;/tmp/drivers/drivers.csv&#39; OVERWRITE INTO TABLE drivers_regex;

SELECT * FROM drivers_regex LIMIT 5;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DROP TABLE IF EXISTS drivers_regex;
OK
Time taken: 0.079 seconds
CREATE TABLE drivers_regex(
    driverId  INT,
    name      STRING,
    ssn       BIGINT,
    location  STRING,
    certified STRING,
    wageplan  STRING)
ROW FORMAT SERDE
    &#39;org.apache.hadoop.hive.serde2.RegexSerDe&#39;
WITH SERDEPROPERTIES (
   &#39;input.regex&#39; = &#39;(\\d+),([^,]*),(\\d+),([^,]*),([^,]*),([^,]*)&#39;)
TBLPROPERTIES (&#34;skip.header.line.count&#34;=&#34;1&#34;);
OK
Time taken: 0.074 seconds
egex;DATA INPATH &#39;/tmp/drivers/drivers.csv&#39; OVERWRITE INTO TABLE drivers_r
Loading data to table default.drivers_regex
OK
Time taken: 0.433 seconds
SELECT * FROM drivers_regex LIMIT 5;
OK
10      George Vetticaden       621011971       244-4532 Nulla Rd.      N       miles
11      Jamie Engesser  262112338       366-4125 Ac Street      N       miles
12      Paul Coddin     198041975       Ap #622-957 Risus. Street       Y       hours
13      Joe Niemiec     139907145       2071 Hendrerit. Ave     Y       hours
14      Adis Cesir      820812209       Ap #810-1228 In St.     Y       hours
Time taken: 0.132 seconds, Fetched: 5 row(s)
</pre></div></div>
</div>
<p>La expresión regular usada es la siguiente:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(\\d+),([^,]*),(\\d+),([^,]*),([^,]*),([^,]*)`
</pre></div>
</div>
<p>donde:</p>
<ul class="simple">
<li><p>Los paréntesis indica los campos, esto es, <code class="docutils literal notranslate"><span class="pre">(\\d+)</span></code> es el primer campo, <code class="docutils literal notranslate"><span class="pre">([^,]*)</span></code> es el segundo y así sucesivamente.</p></li>
<li><p>Se indica que la coma es el separador entre campos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(\\d+)</span></code> representa una cadena de uno o más dígitos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[...]</span></code> representan uno o más posibles caracteres, de tal forma que <code class="docutils literal notranslate"><span class="pre">[^,]</span></code> indica cualquier caracter excepto una coma. Finalmente, el * indica cero, una o más ocurrencias. Es así como <code class="docutils literal notranslate"><span class="pre">[^,]*</span></code> representa cualquier cadena de caracteres que no contenga una coma.</p></li>
<li><p>La expresión regular usada indica que los campos 1 y 3 son numéricos, y los restantes son texto.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>rm drivers.* *.log
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Juan D. Velasquez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>