

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Predicción de gastos médicos en sparklyr &mdash; documentación de --- Cursos --- - </title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="Laboratorios de Programación" href="../../analitica-de-grandes-datos/grades.html" />
    <link rel="prev" title="Segmentación del mercado de adolecentes en sparklyr" href="sparklyr-clustering.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../analitica-de-grandes-datos/content.html">Sesiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/grades.html">Laboratorios de Programación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/course-info.html">Información del curso</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/content.html">Sesiones</a> &raquo;</li>
        
      <li>Predicción de gastos médicos en sparklyr</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/sparklyr/sparklyr-regression.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Predicción-de-gastos-médicos-en-sparklyr">
<h1>Predicción de gastos médicos en sparklyr<a class="headerlink" href="#Predicción-de-gastos-médicos-en-sparklyr" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li><p><em>30 min</em> | Última modificación: Junio 22, 2019</p></li>
</ul>
<p>En este documento se abora como resolver este problema de regresión usando Sparklyr.</p>
<div class="section" id="Definición-del-problema">
<h2>Definición del problema<a class="headerlink" href="#Definición-del-problema" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Una compañía de seguros desea pronósticar los gastos médicos de la población asegurada con el fin de recolectar un valor superior en ingresos, tal que le permita obtener utilidades. Los costos son difíciles de pronósticar ya que las condiciones más costosas son más raras y parecen aleatorias; y que ciertas condiciones son más probables para ciertos segmentos de la población (infarto en personas obesas y cáncer en fumadores).</p>
<p>El objetivo es usar una base de datos con 1338 registros de gastos médicos hipotéticos para pacientes de EU con el fin de estimar los costos para determinados segmentos de la población. La información registrada es la siguiente:</p>
<ul class="simple">
<li><p>Age: entero hasta 64.</p></li>
<li><p>Sex: male, female.</p></li>
<li><p>bmi: Body mass index.</p></li>
<li><p>children: entero indicando la cantidad de hijos/dependientes cubiertos por el plan de salud.</p></li>
<li><p>smoker: yes, no.</p></li>
<li><p>region: northest, southeast, southwest, northwest.</p></li>
<li><p>charges: costos.</p></li>
</ul>
</div>
<div class="section" id="Solución">
<h2>Solución<a class="headerlink" href="#Solución" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="Preparación">
<h3>Preparación<a class="headerlink" href="#Preparación" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Esta función se usará para ejecutar comandos en el</span>
<span class="c1">## sistema operativo y capturar la salida.</span>
<span class="c1">##</span>
<span class="n">systemp</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="nf">cat</span><span class="p">(</span><span class="nf">system</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">intern</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">library</span><span class="p">(</span><span class="n">sparklyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">spark_installed_versions</span><span class="p">()</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s">&#39;local&#39;</span><span class="p">,</span> <span class="n">spark_home</span><span class="o">=</span><span class="s">&#39;/home/vagrant/spark/spark-2.4.3-bin-hadoop2.7&#39;</span><span class="p">)</span>
<span class="nf">spark_version</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 1 × 3</caption>
<thead>
    <tr><th scope=col>spark</th><th scope=col>hadoop</th><th scope=col>dir</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2.4.3</td><td>2.7</td><td>/home/vagrant/spark/spark-2.4.3-bin-hadoop2.7</td></tr>
</tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1] ‘2.4.3’
</pre></div></div>
</div>
</div>
<div class="section" id="Carga-de-datos">
<h3>Carga de datos<a class="headerlink" href="#Carga-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se mueve el archivo de la máquina local a sistema HDFS.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## copia el archivo al HDFS</span>
<span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;hdfs dfs -copyFromLocal insurance.csv /tmp/insurance.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Warning message:
“running command &#39;hdfs dfs -copyFromLocal insurance.csv /tmp/insurance.csv&#39; had status 1”
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>Se realizar la carga de los datos en SparkR, y se verifica la lectura del archivo.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="n">spark_df</span> <span class="o">&lt;-</span> <span class="nf">spark_read_csv</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span>                    <span class="c1">## spark_connection</span>
                           <span class="s">&#39;insurance&#39;</span><span class="p">,</span>           <span class="c1">## nombre de la tabla</span>
                           <span class="s">&#39;/tmp/insurance.csv&#39;</span><span class="p">)</span>  <span class="c1">## ubicación del archivo</span>
                                                  <span class="c1">## en el sistema hdfs</span>
<span class="n">spark_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;insurance&gt; [?? x 7]</span>
     age sex      bmi children smoker region    charges
   <span style="color: rgb(148,148,148)">&lt;int&gt;</span> <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>  <span style="color: rgb(148,148,148)">&lt;dbl&gt;</span>    <span style="color: rgb(148,148,148)">&lt;int&gt;</span> <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>  <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>       <span style="color: rgb(148,148,148)">&lt;dbl&gt;</span>
<span style="color: rgb(188,188,188)"> 1</span>    19 female  27.9        0 yes    southwest  <span class="ansi-underline">1</span><span class="ansi-underline">6</span>885.
<span style="color: rgb(188,188,188)"> 2</span>    18 male    33.8        1 no     southeast   <span class="ansi-underline">1</span>726.
<span style="color: rgb(188,188,188)"> 3</span>    28 male    33          3 no     southeast   <span class="ansi-underline">4</span>449.
<span style="color: rgb(188,188,188)"> 4</span>    33 male    22.7        0 no     northwest  <span class="ansi-underline">2</span><span class="ansi-underline">1</span>984.
<span style="color: rgb(188,188,188)"> 5</span>    32 male    28.9        0 no     northwest   <span class="ansi-underline">3</span>867.
<span style="color: rgb(188,188,188)"> 6</span>    31 female  25.7        0 no     southeast   <span class="ansi-underline">3</span>757.
<span style="color: rgb(188,188,188)"> 7</span>    46 female  33.4        1 no     southeast   <span class="ansi-underline">8</span>241.
<span style="color: rgb(188,188,188)"> 8</span>    37 female  27.7        3 no     northwest   <span class="ansi-underline">7</span>282.
<span style="color: rgb(188,188,188)"> 9</span>    37 male    29.8        2 no     northeast   <span class="ansi-underline">6</span>406.
<span style="color: rgb(188,188,188)">10</span>    60 female  25.8        0 no     northwest  <span class="ansi-underline">2</span><span class="ansi-underline">8</span>923.
<span style="color: rgb(148,148,148)"># … with more rows</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se imprime el esquema en formato de arbol</span>
<span class="c1">##</span>
<span class="nf">sdf_schema</span><span class="p">(</span><span class="n">spark_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<dl>
    <dt>$age</dt>
            <dd><dl>
    <dt>$name</dt>
            <dd>'age'</dd>
    <dt>$type</dt>
            <dd>'IntegerType'</dd>
</dl>
</dd>
    <dt>$sex</dt>
            <dd><dl>
    <dt>$name</dt>
            <dd>'sex'</dd>
    <dt>$type</dt>
            <dd>'StringType'</dd>
</dl>
</dd>
    <dt>$bmi</dt>
            <dd><dl>
    <dt>$name</dt>
            <dd>'bmi'</dd>
    <dt>$type</dt>
            <dd>'DoubleType'</dd>
</dl>
</dd>
    <dt>$children</dt>
            <dd><dl>
    <dt>$name</dt>
            <dd>'children'</dd>
    <dt>$type</dt>
            <dd>'IntegerType'</dd>
</dl>
</dd>
    <dt>$smoker</dt>
            <dd><dl>
    <dt>$name</dt>
            <dd>'smoker'</dd>
    <dt>$type</dt>
            <dd>'StringType'</dd>
</dl>
</dd>
    <dt>$region</dt>
            <dd><dl>
    <dt>$name</dt>
            <dd>'region'</dd>
    <dt>$type</dt>
            <dd>'StringType'</dd>
</dl>
</dd>
    <dt>$charges</dt>
            <dd><dl>
    <dt>$name</dt>
            <dd>'charges'</dd>
    <dt>$type</dt>
            <dd>'DoubleType'</dd>
</dl>
</dd>
</dl></div>
</div>
</div>
<div class="section" id=" Análisis-exploratorio">
<h3> Análisis exploratorio<a class="headerlink" href="# Análisis-exploratorio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La función <code class="docutils literal notranslate"><span class="pre">summary</span></code> de SparkR permite obtener los principales estadísticos del DataFrame. Puesto que dicha función retorna un DataFrame de Spark, es necesario usar <code class="docutils literal notranslate"><span class="pre">collect()</span></code> para visualizar la tabla de resultados.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">summary</span><span class="p">(</span><span class="n">spark_df</span> <span class="o">%&gt;%</span> <span class="nf">collect</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
      age            sex                 bmi           children
 Min.   :18.00   Length:1338        Min.   :15.96   Min.   :0.000
 1st Qu.:27.00   Class :character   1st Qu.:26.30   1st Qu.:0.000
 Median :39.00   Mode  :character   Median :30.40   Median :1.000
 Mean   :39.21                      Mean   :30.66   Mean   :1.095
 3rd Qu.:51.00                      3rd Qu.:34.69   3rd Qu.:2.000
 Max.   :64.00                      Max.   :53.13   Max.   :5.000
    smoker             region             charges
 Length:1338        Length:1338        Min.   : 1122
 Class :character   Class :character   1st Qu.: 4740
 Mode  :character   Mode  :character   Median : 9382
                                       Mean   :13270
                                       3rd Qu.:16640
                                       Max.   :63770
</pre></div></div>
</div>
<p>Por otra parte, es posible usar la función <code class="docutils literal notranslate"><span class="pre">summary</span></code> para obtener los estadísticos descriptivos de una columna. En este caso, primero se selecciona la columna y luego se aplica <code class="docutils literal notranslate"><span class="pre">summary</span></code>.</p>
<p>SparkR también implementa la función <code class="docutils literal notranslate"><span class="pre">histogram</span></code> para computar el histograma de una columna de un DataFrame. En este caso, debe usarse la librería <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> para realizar la correspondiente gráfica.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="n">spark_df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="s">&#39;age&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">collect</span><span class="p">()</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_sparklyr_sparklyr-regression_20_0.png" src="../../_images/notebooks_sparklyr_sparklyr-regression_20_0.png" />
</div>
</div>
<p>Muchas funciones de uso común en R no están disponibles en SparkR, por lo que resulta necesario usar <code class="docutils literal notranslate"><span class="pre">collect()</span></code> para obtener el contenido de la variable y luego aplicar la función requerida.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="n">spark_df</span> <span class="o">%&gt;%</span>  <span class="nf">group_by</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">count</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;?&gt; [?? x 2]</span>
  region    count
  <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>     <span style="color: rgb(148,148,148)">&lt;dbl&gt;</span>
<span style="color: rgb(188,188,188)">1</span> northwest   325
<span style="color: rgb(188,188,188)">2</span> southwest   325
<span style="color: rgb(188,188,188)">3</span> southeast   364
<span style="color: rgb(188,188,188)">4</span> northeast   324
</pre></div></div>
</div>
<p>No obstante, algunas veces es posible utilizar los operadores de agregación de SQL para realizar los cómputos equivalentes. En sl siguiente fragmento de código, se usa la función <code class="docutils literal notranslate"><span class="pre">groupBy</span></code> para calcular la cantidad de registros por región.</p>
<p>A continuación, se traen los datos al entorno local para calcula la correlación entre las columnas del DataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">cor</span><span class="p">(</span><span class="n">spark_df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="s">&quot;bmi&quot;</span><span class="p">,</span> <span class="s">&quot;children&quot;</span><span class="p">,</span> <span class="s">&quot;charges&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">collect</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A matrix: 4 × 4 of type dbl</caption>
<thead>
    <tr><th></th><th scope=col>age</th><th scope=col>bmi</th><th scope=col>children</th><th scope=col>charges</th></tr>
</thead>
<tbody>
    <tr><th scope=row>age</th><td>1.0000000</td><td>0.1092719</td><td>0.04246900</td><td>0.29900819</td></tr>
    <tr><th scope=row>bmi</th><td>0.1092719</td><td>1.0000000</td><td>0.01275890</td><td>0.19834097</td></tr>
    <tr><th scope=row>children</th><td>0.0424690</td><td>0.0127589</td><td>1.00000000</td><td>0.06799823</td></tr>
    <tr><th scope=row>charges</th><td>0.2990082</td><td>0.1983410</td><td>0.06799823</td><td>1.00000000</td></tr>
</tbody>
</table></div>
</div>
<p>Este procedimiento de importación de datos, también puede usarse para construir gráficos.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">repr.plot.height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="nf">pairs</span><span class="p">(</span><span class="n">spark_df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="s">&quot;bmi&quot;</span><span class="p">,</span> <span class="s">&quot;children&quot;</span><span class="p">,</span> <span class="s">&quot;charges&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">collect</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_sparklyr_sparklyr-regression_27_0.png" src="../../_images/notebooks_sparklyr_sparklyr-regression_27_0.png" />
</div>
</div>
</div>
<div class="section" id=" Construcción-del-modelo">
<h3> Construcción del modelo<a class="headerlink" href="# Construcción-del-modelo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A continuación se usa la función <code class="docutils literal notranslate"><span class="pre">spark.gml</span></code> para la especificación de modelos lineales generalizados. Una lista de los algoritmos disponibles en SparR puede ser consultada en <a class="reference external" href="https://spark.apache.org/docs/latest/sparkr.html#algorithms">https://spark.apache.org/docs/latest/sparkr.html#algorithms</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">&lt;-</span> <span class="n">spark_df</span> <span class="o">%&gt;%</span> <span class="nf">ml_linear_regression</span><span class="p">(</span><span class="n">charges</span> <span class="o">~</span> <span class="n">age</span> <span class="o">+</span> <span class="n">children</span> <span class="o">+</span> <span class="n">bmi</span> <span class="o">+</span> <span class="n">sex</span> <span class="o">+</span> <span class="n">smoker</span> <span class="o">+</span> <span class="n">region</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">summary</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Deviance Residuals:
     Min       1Q   Median       3Q      Max
-11304.9  -2848.1   -982.1   1393.9  29992.8

Coefficients:
     (Intercept)              age         children              bmi
      11909.9960         256.8564         475.5005         339.1935
        sex_male        smoker_no region_southeast region_southwest
       -131.3144      -23848.5345       -1035.0220        -960.0510
region_northwest
       -352.9639

R-Squared: 0.7509
Root Mean Squared Error: 6042
</pre></div></div>
</div>
<p>La sintaxis sigue siendo similar a la tradicional en R. A continuación se obtiene el pronóstico del modelo para el conjunto de datos.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="n">fitted</span> <span class="o">&lt;-</span> <span class="nf">ml_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">spark_df</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">collect</span>
<span class="nf">head</span><span class="p">(</span><span class="n">fitted</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A tibble: 6 × 8</caption>
<thead>
    <tr><th scope=col>age</th><th scope=col>sex</th><th scope=col>bmi</th><th scope=col>children</th><th scope=col>smoker</th><th scope=col>region</th><th scope=col>charges</th><th scope=col>prediction</th></tr>
    <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>19</td><td>female</td><td>27.900</td><td>0</td><td>yes</td><td>southwest</td><td>16884.924</td><td>25293.713</td></tr>
    <tr><td>18</td><td>male  </td><td>33.770</td><td>1</td><td>no </td><td>southeast</td><td> 1725.552</td><td> 3448.603</td></tr>
    <tr><td>28</td><td>male  </td><td>33.000</td><td>3</td><td>no </td><td>southeast</td><td> 4449.462</td><td> 6706.988</td></tr>
    <tr><td>33</td><td>male  </td><td>22.705</td><td>0</td><td>no </td><td>northwest</td><td>21984.471</td><td> 3754.830</td></tr>
    <tr><td>32</td><td>male  </td><td>28.880</td><td>0</td><td>no </td><td>northwest</td><td> 3866.855</td><td> 5592.493</td></tr>
    <tr><td>31</td><td>female</td><td>25.740</td><td>0</td><td>no </td><td>southeast</td><td> 3756.622</td><td> 3719.826</td></tr>
</tbody>
</table></div>
</div>
<p>Finalmente, se grafica los valores reales y los pronosticados para la variable <code class="docutils literal notranslate"><span class="pre">charges</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">fitted</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;charges&quot;</span><span class="p">,</span> <span class="s">&quot;prediction&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">collect</span>

<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span> <span class="o">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">repr.plot.height</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">$</span><span class="n">charges</span><span class="p">,</span> <span class="n">df</span><span class="o">$</span><span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_sparklyr_sparklyr-regression_35_0.png" src="../../_images/notebooks_sparklyr_sparklyr-regression_35_0.png" />
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Juan D. Velasquez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>