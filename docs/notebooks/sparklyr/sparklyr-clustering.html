

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Segmentación del mercado de adolecentes en sparklyr &mdash; documentación de --- Cursos --- - </title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="Predicción de gastos médicos en sparklyr" href="sparklyr-regression.html" />
    <link rel="prev" title="Diagnóstico del cáncer de mama usando sparklyr" href="sparklyr-classification.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../analitica-de-grandes-datos/content.html">Sesiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/grades.html">Laboratorios de Programación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/course-info.html">Información del curso</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/content.html">Sesiones</a> &raquo;</li>
        
      <li>Segmentación del mercado de adolecentes en sparklyr</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/sparklyr/sparklyr-clustering.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Segmentación-del-mercado-de-adolecentes-en-sparklyr">
<h1>Segmentación del mercado de adolecentes en sparklyr<a class="headerlink" href="#Segmentación-del-mercado-de-adolecentes-en-sparklyr" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li><p><em>30 min</em> | Última modificación: Junio 22, 2019</p></li>
</ul>
<p>En este tutorial se aplica el algoritmo K-means para clasificar un grupo de adolecentes con base en sus intéreses, con el fin de diseñar estrategias publicitarias y servicios encaminados a cada grupo de interés usando SparkR. Este tutorial se enfoca en la programación de Sparklyr y no en el análisis del problema. Para abordar este tutorial, el lector debe tener suficiencia en los módulos correspondientes de analítica predictiva.</p>
<div class="section" id="Definición-del-problema">
<h2>Definición del problema<a class="headerlink" href="#Definición-del-problema" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Un vendedor desea enviar publicidad electrónica a una población de adolecentes y adultos jóvenes con el fin de maximizar sus ventas. Para ello, desea poder clasificar a sus clientes potenciales por grupos de interés de acuerdo con sus intereses y consecuentemente enviar publicidad específica a cada uno de ellos.</p>
<p>En este problema se desea determina que grupos de interés existen en una población de clientes a partir de los mensajes enviados por un servicio de redes sociales. La información disponible consiste en 30000 observaciones de 40 variables que podrían caracterizar los intereses de la población analizada. Estas variables corresponden a palabras que pueden asociarse a un interés de la poblaión analizada. Cada variable mide la frecuencia con que una determinada palabra aparece en los mensajes de
texto; adicionalmente, dentro de estas variables se incluye información como el sexo, la edad y la cantidad de contactos de la persona.</p>
</div>
<div class="section" id="Solución">
<h2>Solución<a class="headerlink" href="#Solución" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="Preparación">
<h3>Preparación<a class="headerlink" href="#Preparación" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Esta función se usará para ejecutar comandos en el</span>
<span class="c1">## sistema operativo y capturar la salida.</span>
<span class="c1">##</span>
<span class="n">systemp</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="nf">cat</span><span class="p">(</span><span class="nf">system</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">intern</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">library</span><span class="p">(</span><span class="n">sparklyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">spark_installed_versions</span><span class="p">()</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s">&#39;local&#39;</span><span class="p">,</span> <span class="n">spark_home</span><span class="o">=</span><span class="s">&#39;/home/vagrant/spark/spark-2.4.3-bin-hadoop2.7&#39;</span><span class="p">)</span>
<span class="nf">spark_version</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 1 × 3</caption>
<thead>
    <tr><th scope=col>spark</th><th scope=col>hadoop</th><th scope=col>dir</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2.4.3</td><td>2.7</td><td>/home/vagrant/spark/spark-2.4.3-bin-hadoop2.7</td></tr>
</tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1] ‘2.4.3’
</pre></div></div>
</div>
</div>
<div class="section" id=" Carga-de-datos">
<h3> Carga de datos<a class="headerlink" href="# Carga-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El archivo con los datos se encuentra en la carpeta actual de trabajo en la máquina local.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## copia el archivo al HDFS</span>
<span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;hdfs dfs -copyFromLocal snsdata.csv /tmp/snsdata.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Warning message:
“running command &#39;hdfs dfs -copyFromLocal insurance.csv /tmp/snsdata.csv&#39; had status 1”
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">&lt;-</span>
<span class="nf">spark_read_csv</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span>                  <span class="c1">## spark_connection</span>
               <span class="s">&#39;snsdata&#39;</span><span class="p">,</span>           <span class="c1">## nombre de la tabla</span>
               <span class="s">&#39;/tmp/snsdata.csv&#39;</span><span class="p">)</span>  <span class="c1">## ubicación del archivo</span>
                                    <span class="c1">## en el sistema hdfs</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;snsdata&gt; [?? x 40]</span>
   gradyear gender   age friends basketball football soccer softball volleyball
      <span style="color: rgb(148,148,148)">&lt;int&gt;</span> <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>  <span style="color: rgb(148,148,148)">&lt;dbl&gt;</span>   <span style="color: rgb(148,148,148)">&lt;int&gt;</span>      <span style="color: rgb(148,148,148)">&lt;int&gt;</span>    <span style="color: rgb(148,148,148)">&lt;int&gt;</span>  <span style="color: rgb(148,148,148)">&lt;int&gt;</span>    <span style="color: rgb(148,148,148)">&lt;int&gt;</span>      <span style="color: rgb(148,148,148)">&lt;int&gt;</span>
<span style="color: rgb(188,188,188)"> 1</span>     <span class="ansi-underline">2</span>006 M       19.0       7          0        0      0        0          0
<span style="color: rgb(188,188,188)"> 2</span>     <span class="ansi-underline">2</span>006 F       18.8       0          0        1      0        0          0
<span style="color: rgb(188,188,188)"> 3</span>     <span class="ansi-underline">2</span>006 M       18.3      69          0        1      0        0          0
<span style="color: rgb(188,188,188)"> 4</span>     <span class="ansi-underline">2</span>006 F       18.9       0          0        0      0        0          0
<span style="color: rgb(188,188,188)"> 5</span>     <span class="ansi-underline">2</span>006 NA      19.0      10          0        0      0        0          0
<span style="color: rgb(188,188,188)"> 6</span>     <span class="ansi-underline">2</span>006 F      <span class="ansi-red-fg">NaN</span>       142          0        0      0        0          0
<span style="color: rgb(188,188,188)"> 7</span>     <span class="ansi-underline">2</span>006 F       18.9      72          0        0      0        0          0
<span style="color: rgb(188,188,188)"> 8</span>     <span class="ansi-underline">2</span>006 M       18.3      17          0        0      0        1          0
<span style="color: rgb(188,188,188)"> 9</span>     <span class="ansi-underline">2</span>006 F       19.1      52          0        0      0        0          0
<span style="color: rgb(188,188,188)">10</span>     <span class="ansi-underline">2</span>006 F       18.7      39          0        0      0        0          0
<span style="color: rgb(148,148,148)"># … with more rows, and 31 more variables: swimming </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, cheerleading </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">,
#   baseball </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, tennis </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, sports </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, cute </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, sex </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">,
#   sexy </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, hot </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, kissed </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, dance </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, band </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">,
#   marching </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, music </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, rock </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, god </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, church </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">,
#   jesus </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, bible </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, hair </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, dress </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, blonde </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">,
#   mall </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, shopping </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, clothes </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, hollister </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">,
#   abercrombie </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, die </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, death </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, drunk </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span><span style="color: rgb(148,148,148)">, drugs </span><span style="color: rgb(148,148,148)">&lt;int&gt;</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Cantidad de registros leidos</span>
<span class="c1">##</span>
<span class="nf">count</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;?&gt; [?? x 1]</span>
      n
  <span style="color: rgb(148,148,148)">&lt;dbl&gt;</span>
<span style="color: rgb(188,188,188)">1</span> <span class="ansi-underline">3</span><span class="ansi-underline">0</span>000
</pre></div></div>
</div>
</div>
<div class="section" id="Análisis-exploratorio">
<h3>Análisis exploratorio<a class="headerlink" href="#Análisis-exploratorio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A continuación se ejemplifican algunos cómputos típicos para el análisis exploratorio.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Conteo por género</span>
<span class="c1">##</span>
<span class="n">df</span> <span class="o">%&gt;%</span>  <span class="nf">group_by</span><span class="p">(</span><span class="n">gender</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">count</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;?&gt; [?? x 2]</span>
  gender count
  <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>  <span style="color: rgb(148,148,148)">&lt;dbl&gt;</span>
<span style="color: rgb(188,188,188)">1</span> M       <span class="ansi-underline">5</span>222
<span style="color: rgb(188,188,188)">2</span> F      <span class="ansi-underline">2</span><span class="ansi-underline">2</span>054
<span style="color: rgb(188,188,188)">3</span> NA      <span class="ansi-underline">2</span>724
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Conteo por género</span>
<span class="c1">##</span>
<span class="nf">table</span><span class="p">(</span><span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">gender</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">collect</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

    F     M    NA
22054  5222  2724
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Estadísticos por rango de edades</span>
<span class="c1">##</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">collect</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
      age
 Min.   :  3.086
 1st Qu.: 16.312
 Median : 17.287
 Mean   : 17.994
 3rd Qu.: 18.259
 Max.   :106.927
 NA&#39;s   :5086
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Estadísticos por rango de edades</span>
<span class="c1">##</span>
<span class="nf">sdf_describe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;?&gt; [?? x 2]</span>
  summary age
  <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>   <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>
<span style="color: rgb(188,188,188)">1</span> count   24914
<span style="color: rgb(188,188,188)">2</span> mean    17.993949546439772
<span style="color: rgb(188,188,188)">3</span> stddev  7.858054477853863
<span style="color: rgb(188,188,188)">4</span> min     3.086
<span style="color: rgb(188,188,188)">5</span> max     106.927
</pre></div></div>
</div>
<p>Los métodos que pueden aplicarse a las columnas están listados en: <a class="reference external" href="https://spark.rstudio.com/reference/">https://spark.rstudio.com/reference/</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Cantidad de nulos en la columna age</span>
<span class="c1">##</span>
<span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="nf">isNull</span><span class="p">(</span><span class="n">age</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="n">count</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;?&gt; [?? x 1]</span>
      n
  <span style="color: rgb(148,148,148)">&lt;dbl&gt;</span>
<span style="color: rgb(188,188,188)">1</span>  <span class="ansi-underline">5</span>086
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se agrega una columna con las edades entre 13 y 19,</span>
<span class="c1">## reemplazando por null los valores por fuera de este</span>
<span class="c1">## rango</span>
<span class="c1">##</span>
<span class="n">df</span> <span class="o">&lt;-</span>
<span class="nf">mutate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
       <span class="n">age1319</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="m">13</span> <span class="o">&amp;</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="m">20</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="kc">NA</span><span class="p">))</span>

<span class="c1">##</span>
<span class="c1">## Se verifican los valores en la nueva columna</span>
<span class="c1">##</span>
<span class="nf">sdf_describe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">&#39;age1319&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span style="color: rgb(148,148,148)"># Source: spark&lt;?&gt; [?? x 2]</span>
  summary age1319
  <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>   <span style="color: rgb(148,148,148)">&lt;chr&gt;</span>
<span style="color: rgb(188,188,188)">1</span> count   24477
<span style="color: rgb(188,188,188)">2</span> mean    17.25242893328433
<span style="color: rgb(188,188,188)">3</span> stddev  1.1574649278955391
<span style="color: rgb(188,188,188)">4</span> min     13.027
<span style="color: rgb(188,188,188)">5</span> max     19.995
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se calcula la edad promedio por año</span>
<span class="c1">## de graduación para la muestra en el</span>
<span class="c1">## rango de edades considerado</span>
<span class="c1">##</span>
<span class="n">age_df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">gradyear</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">avg_age</span> <span class="o">=</span> <span class="nf">avg</span><span class="p">(</span><span class="n">age</span><span class="p">))</span>

<span class="n">age_df</span> <span class="o">%&gt;%</span> <span class="n">collect</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A tibble: 4 × 2</caption>
<thead>
    <tr><th scope=col>gradyear</th><th scope=col>avg_age</th></tr>
    <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2009</td><td>16.87602</td></tr>
    <tr><td>2006</td><td>19.13724</td></tr>
    <tr><td>2007</td><td>18.39146</td></tr>
    <tr><td>2008</td><td>17.52387</td></tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="Entrenamiento-del-modelo">
<h3>Entrenamiento del modelo<a class="headerlink" href="#Entrenamiento-del-modelo" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Agrupamiento usando k-means</span>
<span class="c1">##</span>
<span class="n">model</span> <span class="o">&lt;-</span>
<span class="nf">ml_kmeans</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="o">~</span> <span class="n">friends</span> <span class="o">+</span> <span class="n">basketball</span> <span class="o">+</span> <span class="n">football</span> <span class="o">+</span> <span class="n">soccer</span> <span class="o">+</span> <span class="n">softball</span> <span class="o">+</span>
      <span class="n">volleyball</span> <span class="o">+</span> <span class="n">swimming</span> <span class="o">+</span> <span class="n">cheerleading</span> <span class="o">+</span> <span class="n">baseball</span> <span class="o">+</span> <span class="n">tennis</span> <span class="o">+</span>
      <span class="n">sports</span> <span class="o">+</span> <span class="n">cute</span> <span class="o">+</span> <span class="n">sex</span> <span class="o">+</span> <span class="n">sexy</span> <span class="o">+</span> <span class="n">hot</span> <span class="o">+</span> <span class="n">kissed</span> <span class="o">+</span> <span class="n">dance</span> <span class="o">+</span> <span class="n">band</span> <span class="o">+</span>
      <span class="n">marching</span> <span class="o">+</span> <span class="n">music</span> <span class="o">+</span> <span class="n">rock</span> <span class="o">+</span> <span class="n">god</span> <span class="o">+</span> <span class="n">church</span> <span class="o">+</span> <span class="n">jesus</span> <span class="o">+</span> <span class="n">bible</span> <span class="o">+</span>
      <span class="n">hair</span> <span class="o">+</span> <span class="n">dress</span> <span class="o">+</span> <span class="n">blonde</span> <span class="o">+</span> <span class="n">mall</span> <span class="o">+</span> <span class="n">shopping</span> <span class="o">+</span> <span class="n">clothes</span> <span class="o">+</span> <span class="n">hollister</span> <span class="o">+</span>
      <span class="n">abercrombie</span> <span class="o">+</span> <span class="n">die</span> <span class="o">+</span> <span class="n">death</span> <span class="o">+</span> <span class="n">drunk</span> <span class="o">+</span> <span class="n">drugs</span><span class="p">,</span>
    <span class="n">k</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="m">100</span><span class="p">,</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="m">12345</span><span class="p">,</span>
    <span class="n">prediction_col</span> <span class="o">=</span> <span class="s">&#39;cluster&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Pronóstico del cluster de cada grupo</span>
<span class="c1">##</span>
<span class="n">fitted</span> <span class="o">&lt;-</span> <span class="nf">ml_predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">collect</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Análisis-del-modelo">
<h3>Análisis del modelo<a class="headerlink" href="#Análisis-del-modelo" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Cantidad de patrones por cluster</span>
<span class="c1">##</span>
<span class="n">fitted</span> <span class="o">%&gt;%</span>  <span class="nf">group_by</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">count</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A tibble: 5 × 2</caption>
<thead>
    <tr><th scope=col>cluster</th><th scope=col>count</th></tr>
    <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>0</td><td> 3502</td></tr>
    <tr><td>1</td><td>16886</td></tr>
    <tr><td>2</td><td>    7</td></tr>
    <tr><td>3</td><td> 8994</td></tr>
    <tr><td>4</td><td>  611</td></tr>
</tbody>
</table></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Juan D. Velasquez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>