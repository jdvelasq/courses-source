

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sparklyr &mdash; documentación de --- Cursos --- - </title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="Diagnóstico del cáncer de mama usando sparklyr" href="sparklyr-classification.html" />
    <link rel="prev" title="Análisis de datos usando sparklyr" href="sparkly-flights.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../analitica-de-grandes-datos/content.html">Sesiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/grades.html">Laboratorios de Programación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/course-info.html">Información del curso</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/content.html">Sesiones</a> &raquo;</li>
        
      <li>sparklyr</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/sparklyr/sparklyr.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="sparklyr">
<h1>sparklyr<a class="headerlink" href="#sparklyr" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li><p><em>30 min</em> | Última modificación: Junio 22, 2019.</p></li>
</ul>
<p>Spark SQL es una interfaz para el procesamiento de datos estructurados usando el lenguaje SQL. En adición, Spark SQL también puede ser usado para leer datos de Apache Hive. Spark SQL opera sobre DataFrames, los cuales son Datasets (RDD) organizado por columnas identificadas por nombres, los cuales equivalen a tablas en los sistemas de bases de datos relacionales.</p>
<p><strong>Test de la implementación</strong>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> rpy2.ipython
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sparklyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s">&#39;local&#39;</span><span class="p">,</span> <span class="n">spark_home</span><span class="o">=</span><span class="s">&#39;/root/spark/spark-2.4.3-bin-hadoop2.7&#39;</span><span class="p">)</span>
<span class="nf">spark_version</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="nf">src_tbls</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="nf">spark_disconnect</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/conda/lib/python3.7/site-packages/rpy2/rinterface/__init__.py:146: RRuntimeWarning:
Attaching package: ‘dplyr’


  warnings.warn(x, RRuntimeWarning)
/opt/conda/lib/python3.7/site-packages/rpy2/rinterface/__init__.py:146: RRuntimeWarning: The following objects are masked from ‘package:stats’:

    filter, lag


  warnings.warn(x, RRuntimeWarning)
/opt/conda/lib/python3.7/site-packages/rpy2/rinterface/__init__.py:146: RRuntimeWarning: The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union


  warnings.warn(x, RRuntimeWarning)
/opt/conda/lib/python3.7/site-packages/rpy2/rinterface/__init__.py:146: RRuntimeWarning: Registered S3 method overwritten by &#39;openssl&#39;:
  method      from
  print.bytes Rcpp

  warnings.warn(x, RRuntimeWarning)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
NULL

</pre></div></div>
</div>
<div class="section" id="Instalación">
<h2>Instalación<a class="headerlink" href="#Instalación" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La librería <code class="docutils literal notranslate"><span class="pre">sparklyr</span></code> se instala normalmente con:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## install.packages(&quot;sparklyr&quot;)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sparklyr</span></code> puede trabajar en la máquina local o conectarse a un servidor de Spark. En este tutorial se trabajará en la máquina local usando un modo pseudo-distribuido.</p>
<ul>
<li><p>En el sistema hdfs debe existir la carpeta <code class="docutils literal notranslate"><span class="pre">/tmp/hive</span></code> con permisos de lectura y escritura. Si no existe, use:</p>
<p>hdfs dfs -ls /tmp ## para mostrar el contenido de la carpeta /tmp hdfs dfs -mkdir /tmp/hive ## para crear la carpeta hive hdfs dfs -chmod 777 /tmp/hive ## para cambiar los permisos sobre la carpeta</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sparklyr</span></code> requiere su propia instalación local de Spark para ejecutarse. Las funciones relacionadas son las siguientes:</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">## Opciones disponibles de Spark para instalar</span>
<span class="nf">spark_available_versions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  spark
1   1.6
2   2.0
3   2.1
4   2.2
5   2.3
6   2.4

</pre></div></div>
</div>
<p>La función <code class="docutils literal notranslate"><span class="pre">spark_install</span></code> instala una versión de Spark para usar con conexión local. La versión debe corresponder a una de las versiones listadas arriba, por ejemplo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spark_install</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;2.4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Se desinstala con:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spark_uninstall</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;2.4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># spark_install(version = &#39;2.4&#39;)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">## Lista de versiones de Spark instaladas en la máquina local</span>
<span class="nf">spark_installed_versions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  spark hadoop                                   dir
1 2.4.3    2.7 /root/spark/spark-2.4.3-bin-hadoop2.7

</pre></div></div>
</div>
<p>La conexión se realiza con la función <code class="docutils literal notranslate"><span class="pre">spark_connect</span></code>. Note que el parámetro <code class="docutils literal notranslate"><span class="pre">spark_home</span></code> debe coincidir con uno de los directorios listados en la celda de arriba.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spark_connect</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">spark_home</span><span class="o">=</span><span class="s1">&#39;/home/vagrant/spark/spark-2.4.0-bin-hadoop2.7&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">## Carpeta de instalación de Spark</span>
<span class="nf">spark_install_dir</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1] &#34;/root/spark&#34;

</pre></div></div>
</div>
</div>
<div class="section" id="Preparación">
<h2>Preparación<a class="headerlink" href="#Preparación" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Esta función se usará para ejecutar comandos en el sistema operativo</span>
<span class="c1">## y capturar la salida.</span>
<span class="c1">##</span>
<span class="n">systemp</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="nf">cat</span><span class="p">(</span><span class="nf">system</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">intern</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">library</span><span class="p">(</span><span class="n">sparklyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s">&#39;local&#39;</span><span class="p">,</span> <span class="n">spark_home</span><span class="o">=</span><span class="s">&#39;/root/spark/spark-2.4.3-bin-hadoop2.7&#39;</span><span class="p">)</span>
<span class="nf">spark_version</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1] ‘2.4.3’

</pre></div></div>
</div>
</div>
<div class="section" id="Creación-de-DataFrames">
<h2>Creación de DataFrames<a class="headerlink" href="#Creación-de-DataFrames" title="Enlazar permanentemente con este título">¶</a></h2>
<p>A continuación se presenta la carga de DataFrames desde diferentes formatos.</p>
<div class="section" id="Formato-JSON">
<h3>Formato JSON<a class="headerlink" href="#Formato-JSON" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se crea un archivo en formato JSON en la máquina local.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%writefile</span> people.json
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Vivian&quot;</span><span class="p">,</span>   <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Hamilton&quot;</span><span class="p">,</span> <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1971-07-08&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Karen&quot;</span><span class="p">,</span>    <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Holcomb&quot;</span><span class="p">,</span>  <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1974-05-23&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Cody&quot;</span><span class="p">,</span>     <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Garrett&quot;</span><span class="p">,</span>  <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1973-04-22&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Roth&quot;</span><span class="p">,</span>     <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Fry&quot;</span><span class="p">,</span>      <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1975-01-29&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Zoe&quot;</span><span class="p">,</span>      <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Conway&quot;</span><span class="p">,</span>   <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1974-07-03&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>   <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Gretchen&quot;</span><span class="p">,</span> <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Kinney&quot;</span><span class="p">,</span>   <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1974-10-18&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;violet&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Driscoll&quot;</span><span class="p">,</span> <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Klein&quot;</span><span class="p">,</span>    <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1970-10-05&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>   <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Karyn&quot;</span><span class="p">,</span>    <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Diaz&quot;</span><span class="p">,</span>     <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1969-02-24&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>    <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>  <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Merritt&quot;</span><span class="p">,</span>  <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Guy&quot;</span><span class="p">,</span>      <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1974-10-17&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;indigo&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Kylan&quot;</span><span class="p">,</span>    <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Sexton&quot;</span><span class="p">,</span>   <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1975-02-28&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Jordan&quot;</span><span class="p">,</span>   <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Estes&quot;</span><span class="p">,</span>    <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1969-12-07&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;indigo&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Hope&quot;</span><span class="p">,</span>     <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Coffey&quot;</span><span class="p">,</span>   <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1973-12-24&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Vivian&quot;</span><span class="p">,</span>   <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Crane&quot;</span><span class="p">,</span>    <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1970-08-27&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span>   <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Clio&quot;</span><span class="p">,</span>     <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Noel&quot;</span><span class="p">,</span>     <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1972-12-12&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>    <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Hope&quot;</span><span class="p">,</span>     <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Silva&quot;</span><span class="p">,</span>    <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1970-07-01&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>   <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Ayanna&quot;</span><span class="p">,</span>   <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Jarvis&quot;</span><span class="p">,</span>   <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1974-02-11&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Chanda&quot;</span><span class="p">,</span>   <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Boyer&quot;</span><span class="p">,</span>    <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1973-04-01&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>  <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;Chadwick&quot;</span><span class="p">,</span> <span class="s2">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Knight&quot;</span><span class="p">,</span>   <span class="s2">&quot;birthdate&quot;</span><span class="p">:</span> <span class="s2">&quot;1973-04-29&quot;</span><span class="p">,</span>  <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Writing people.json
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## Copia el archivo al HDFS</span>
<span class="o">!</span>hdfs dfs -copyFromLocal people.json /tmp/people.json
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## La función spark_read_json() carga directamente</span>
<span class="c1">## el archivo en JSON con un DataFrame.</span>
<span class="c1">##</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">spark_read_json</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span>                 <span class="c1">## spark_connection</span>
                      <span class="s">&#39;people&#39;</span><span class="p">,</span>           <span class="c1">## nombre de la tabla</span>
                      <span class="s">&#39;/tmp/people.json&#39;</span><span class="p">)</span> <span class="c1">## ubicación del archivo</span>
                                          <span class="c1">## en el sistema hdfs</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;people&gt; [?? x 6]
   birthdate  color  firstname    id quantity surname
   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
 1 1971-07-08 green  Vivian        1        1 Hamilton
 2 1974-05-23 green  Karen         2        4 Holcomb
 3 1973-04-22 orange Cody          3        1 Garrett
 4 1975-01-29 black  Roth          4        1 Fry
 5 1974-07-03 blue   Zoe           5        2 Conway
 6 1974-10-18 violet Gretchen      6        1 Kinney
 7 1970-10-05 blue   Driscoll      7        5 Klein
 8 1969-02-24 red    Karyn         8        1 Diaz
 9 1974-10-17 indigo Merritt       9        4 Guy
10 1975-02-28 black  Kylan        10        4 Sexton
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## La función collect() permite imprimirlo en pantalla</span>
<span class="c1">##</span>
<span class="nf">collect</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# A tibble: 18 x 6
   birthdate  color  firstname    id quantity surname
   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
 1 1971-07-08 green  Vivian        1        1 Hamilton
 2 1974-05-23 green  Karen         2        4 Holcomb
 3 1973-04-22 orange Cody          3        1 Garrett
 4 1975-01-29 black  Roth          4        1 Fry
 5 1974-07-03 blue   Zoe           5        2 Conway
 6 1974-10-18 violet Gretchen      6        1 Kinney
 7 1970-10-05 blue   Driscoll      7        5 Klein
 8 1969-02-24 red    Karyn         8        1 Diaz
 9 1974-10-17 indigo Merritt       9        4 Guy
10 1975-02-28 black  Kylan        10        4 Sexton
11 1969-12-07 indigo Jordan       11        4 Estes
12 1973-12-24 green  Hope         12        5 Coffey
13 1970-08-27 gray   Vivian       13        5 Crane
14 1972-12-12 red    Clio         14        5 Noel
15 1970-07-01 blue   Hope         15        5 Silva
16 1974-02-11 orange Ayanna       16        5 Jarvis
17 1973-04-01 green  Chanda       17        4 Boyer
18 1973-04-29 yellow Chadwick     18        1 Knight

</pre></div></div>
</div>
</div>
<div class="section" id="Formato-CSV">
<h3>Formato CSV<a class="headerlink" href="#Formato-CSV" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A continuación se ejemplifica como procesar un archivo de texto para convertirlo en un DataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%writefile</span> people.csv
<span class="nb">id</span><span class="p">,</span><span class="n">firstname</span><span class="p">,</span><span class="n">surname</span><span class="p">,</span><span class="n">birthdate</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">quantity</span>
<span class="mi">1</span><span class="p">,</span><span class="n">Vivian</span><span class="p">,</span><span class="n">Hamilton</span><span class="p">,</span><span class="mi">1971</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">08</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="mi">1</span>
<span class="mi">2</span><span class="p">,</span><span class="n">Karen</span><span class="p">,</span><span class="n">Holcomb</span><span class="p">,</span><span class="mi">1974</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">23</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="mi">4</span>
<span class="mi">3</span><span class="p">,</span><span class="n">Cody</span><span class="p">,</span><span class="n">Garrett</span><span class="p">,</span><span class="mi">1973</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span><span class="p">,</span><span class="n">orange</span><span class="p">,</span><span class="mi">1</span>
<span class="mi">4</span><span class="p">,</span><span class="n">Roth</span><span class="p">,</span><span class="n">Fry</span><span class="p">,</span><span class="mi">1975</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">29</span><span class="p">,</span><span class="n">black</span><span class="p">,</span><span class="mi">1</span>
<span class="mi">5</span><span class="p">,</span><span class="n">Zoe</span><span class="p">,</span><span class="n">Conway</span><span class="p">,</span><span class="mi">1974</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">03</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span><span class="mi">2</span>
<span class="mi">6</span><span class="p">,</span><span class="n">Gretchen</span><span class="p">,</span><span class="n">Kinney</span><span class="p">,</span><span class="mi">1974</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">18</span><span class="p">,</span><span class="n">violet</span><span class="p">,</span><span class="mi">1</span>
<span class="mi">7</span><span class="p">,</span><span class="n">Driscoll</span><span class="p">,</span><span class="n">Klein</span><span class="p">,</span><span class="mi">1970</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">05</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">8</span><span class="p">,</span><span class="n">Karyn</span><span class="p">,</span><span class="n">Diaz</span><span class="p">,</span><span class="mi">1969</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span><span class="p">,</span><span class="n">red</span><span class="p">,</span><span class="mi">1</span>
<span class="mi">9</span><span class="p">,</span><span class="n">Merritt</span><span class="p">,</span><span class="n">Guy</span><span class="p">,</span><span class="mi">1974</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="n">indigo</span><span class="p">,</span><span class="mi">4</span>
<span class="mi">10</span><span class="p">,</span><span class="n">Kylan</span><span class="p">,</span><span class="n">Sexton</span><span class="p">,</span><span class="mi">1975</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span><span class="p">,</span><span class="n">black</span><span class="p">,</span><span class="mi">4</span>
<span class="mi">11</span><span class="p">,</span><span class="n">Jordan</span><span class="p">,</span><span class="n">Estes</span><span class="p">,</span><span class="mi">1969</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">07</span><span class="p">,</span><span class="n">indigo</span><span class="p">,</span><span class="mi">4</span>
<span class="mi">12</span><span class="p">,</span><span class="n">Hope</span><span class="p">,</span><span class="n">Coffey</span><span class="p">,</span><span class="mi">1973</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">13</span><span class="p">,</span><span class="n">Vivian</span><span class="p">,</span><span class="n">Crane</span><span class="p">,</span><span class="mi">1970</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">27</span><span class="p">,</span><span class="n">gray</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">14</span><span class="p">,</span><span class="n">Clio</span><span class="p">,</span><span class="n">Noel</span><span class="p">,</span><span class="mi">1972</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="n">red</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">15</span><span class="p">,</span><span class="n">Hope</span><span class="p">,</span><span class="n">Silva</span><span class="p">,</span><span class="mi">1970</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">16</span><span class="p">,</span><span class="n">Ayanna</span><span class="p">,</span><span class="n">Jarvis</span><span class="p">,</span><span class="mi">1974</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span><span class="n">orange</span><span class="p">,</span><span class="mi">5</span>
<span class="mi">17</span><span class="p">,</span><span class="n">Chanda</span><span class="p">,</span><span class="n">Boyer</span><span class="p">,</span><span class="mi">1973</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="mi">4</span>
<span class="mi">18</span><span class="p">,</span><span class="n">Chadwick</span><span class="p">,</span><span class="n">Knight</span><span class="p">,</span><span class="mi">1973</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span><span class="p">,</span><span class="n">yellow</span><span class="p">,</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Writing people.csv
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## copia el archivo al HDFS</span>
<span class="o">!</span>hdfs dfs -rm /tmp/people.csv
<span class="o">!</span>hdfs dfs -copyFromLocal people.csv /tmp/people.csv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
rm: `/tmp/people.csv&#39;: No such file or directory
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">spark_read_csv</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span>                 <span class="c1"># spark_connection</span>
                     <span class="s">&#39;people&#39;</span><span class="p">,</span>           <span class="c1"># nombre de la tabla</span>
                     <span class="s">&#39;/tmp/people.csv&#39;</span><span class="p">)</span>  <span class="c1"># ubicación del archivo</span>
                                         <span class="c1"># en el sistema hdfs</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;people&gt; [?? x 6]
      id firstname surname  birthdate           color  quantity
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;     &lt;int&gt;
 1     1 Vivian    Hamilton 1971-07-08 00:00:00 green         1
 2     2 Karen     Holcomb  1974-05-23 00:00:00 green         4
 3     3 Cody      Garrett  1973-04-22 00:00:00 orange        1
 4     4 Roth      Fry      1975-01-29 00:00:00 black         1
 5     5 Zoe       Conway   1974-07-03 00:00:00 blue          2
 6     6 Gretchen  Kinney   1974-10-18 00:00:00 violet        1
 7     7 Driscoll  Klein    1970-10-05 00:00:00 blue          5
 8     8 Karyn     Diaz     1969-02-24 00:00:00 red           1
 9     9 Merritt   Guy      1974-10-17 00:00:00 indigo        4
10    10 Kylan     Sexton   1975-02-28 00:00:00 black         4
# … with more rows

</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Operaciones-sobre-DataFrames">
<h2>Operaciones sobre DataFrames<a class="headerlink" href="#Operaciones-sobre-DataFrames" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">spark_read_csv</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span>                 <span class="c1"># spark_connection</span>
                     <span class="s">&#39;people&#39;</span><span class="p">,</span>           <span class="c1"># nombre de la tabla</span>
                     <span class="s">&#39;/tmp/people.csv&#39;</span><span class="p">)</span>  <span class="c1"># ubicación del archivo</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;people&gt; [?? x 6]
      id firstname surname  birthdate           color  quantity
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;     &lt;int&gt;
 1     1 Vivian    Hamilton 1971-07-08 00:00:00 green         1
 2     2 Karen     Holcomb  1974-05-23 00:00:00 green         4
 3     3 Cody      Garrett  1973-04-22 00:00:00 orange        1
 4     4 Roth      Fry      1975-01-29 00:00:00 black         1
 5     5 Zoe       Conway   1974-07-03 00:00:00 blue          2
 6     6 Gretchen  Kinney   1974-10-18 00:00:00 violet        1
 7     7 Driscoll  Klein    1970-10-05 00:00:00 blue          5
 8     8 Karyn     Diaz     1969-02-24 00:00:00 red           1
 9     9 Merritt   Guy      1974-10-17 00:00:00 indigo        4
10    10 Kylan     Sexton   1975-02-28 00:00:00 black         4
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Imprime el esquema en formato de arbol</span>
<span class="c1">##</span>
<span class="nf">sdf_schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
$id
$id$name
[1] &#34;id&#34;

$id$type
[1] &#34;IntegerType&#34;


$firstname
$firstname$name
[1] &#34;firstname&#34;

$firstname$type
[1] &#34;StringType&#34;


$surname
$surname$name
[1] &#34;surname&#34;

$surname$type
[1] &#34;StringType&#34;


$birthdate
$birthdate$name
[1] &#34;birthdate&#34;

$birthdate$type
[1] &#34;TimestampType&#34;


$color
$color$name
[1] &#34;color&#34;

$color$type
[1] &#34;StringType&#34;


$quantity
$quantity$name
[1] &#34;quantity&#34;

$quantity$type
[1] &#34;IntegerType&#34;



</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Selección de una columna en particular</span>
<span class="c1">##</span>
<span class="nf">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">&#39;firstname&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 1]
   firstname
   &lt;chr&gt;
 1 Vivian
 2 Karen
 3 Cody
 4 Roth
 5 Zoe
 6 Gretchen
 7 Driscoll
 8 Karyn
 9 Merritt
10 Kylan
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Selección de varias columnas</span>
<span class="c1">##</span>
<span class="nf">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;firstname&#39;</span><span class="p">,</span> <span class="s">&#39;surname&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 2]
   firstname surname
   &lt;chr&gt;     &lt;chr&gt;
 1 Vivian    Hamilton
 2 Karen     Holcomb
 3 Cody      Garrett
 4 Roth      Fry
 5 Zoe       Conway
 6 Gretchen  Kinney
 7 Driscoll  Klein
 8 Karyn     Diaz
 9 Merritt   Guy
10 Kylan     Sexton
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Filtrado de registros usando condicionales</span>
<span class="c1">##</span>
<span class="nf">filter</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span> <span class="o">==</span> <span class="s">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 6]
     id firstname surname birthdate           color quantity
  &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;    &lt;int&gt;
1     5 Zoe       Conway  1974-07-03 00:00:00 blue         2
2     7 Driscoll  Klein   1970-10-05 00:00:00 blue         5
3    15 Hope      Silva   1970-07-01 00:00:00 blue         5

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Consultas</span>
<span class="c1">##</span>

<span class="c1">## Se realiza la consulta usando directamente SQL</span>
<span class="n">DBI</span><span class="o">::</span><span class="nf">dbGetQuery</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">&#39;SELECT * FROM people&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   id firstname  surname  birthdate  color quantity
1   1    Vivian Hamilton 1971-07-08  green        1
2   2     Karen  Holcomb 1974-05-23  green        4
3   3      Cody  Garrett 1973-04-22 orange        1
4   4      Roth      Fry 1975-01-29  black        1
5   5       Zoe   Conway 1974-07-03   blue        2
6   6  Gretchen   Kinney 1974-10-18 violet        1
7   7  Driscoll    Klein 1970-10-05   blue        5
8   8     Karyn     Diaz 1969-02-24    red        1
9   9   Merritt      Guy 1974-10-17 indigo        4
10 10     Kylan   Sexton 1975-02-28  black        4
11 11    Jordan    Estes 1969-12-07 indigo        4
12 12      Hope   Coffey 1973-12-24  green        5
13 13    Vivian    Crane 1970-08-27   gray        5
14 14      Clio     Noel 1972-12-12    red        5
15 15      Hope    Silva 1970-07-01   blue        5
16 16    Ayanna   Jarvis 1974-02-11 orange        5
17 17    Chanda    Boyer 1973-04-01  green        4
18 18  Chadwick   Knight 1973-04-29 yellow        1

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">arrange</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">desc</span><span class="p">(</span><span class="n">firstname</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source:     spark&lt;?&gt; [?? x 6]
# Ordered by: desc(firstname)
      id firstname surname  birthdate           color  quantity
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;     &lt;int&gt;
 1     5 Zoe       Conway   1974-07-03 00:00:00 blue          2
 2    13 Vivian    Crane    1970-08-27 00:00:00 gray          5
 3     1 Vivian    Hamilton 1971-07-08 00:00:00 green         1
 4     4 Roth      Fry      1975-01-29 00:00:00 black         1
 5     9 Merritt   Guy      1974-10-17 00:00:00 indigo        4
 6    10 Kylan     Sexton   1975-02-28 00:00:00 black         4
 7     8 Karyn     Diaz     1969-02-24 00:00:00 red           1
 8     2 Karen     Holcomb  1974-05-23 00:00:00 green         4
 9    11 Jordan    Estes    1969-12-07 00:00:00 indigo        4
10    12 Hope      Coffey   1973-12-24 00:00:00 green         5
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">sdf_sort</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;quantity&#39;</span><span class="p">,</span> <span class="s">&#39;firstname&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 6]
      id firstname surname  birthdate           color  quantity
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;     &lt;int&gt;
 1    18 Chadwick  Knight   1973-04-29 00:00:00 yellow        1
 2     3 Cody      Garrett  1973-04-22 00:00:00 orange        1
 3     6 Gretchen  Kinney   1974-10-18 00:00:00 violet        1
 4     8 Karyn     Diaz     1969-02-24 00:00:00 red           1
 5     4 Roth      Fry      1975-01-29 00:00:00 black         1
 6     1 Vivian    Hamilton 1971-07-08 00:00:00 green         1
 7     5 Zoe       Conway   1974-07-03 00:00:00 blue          2
 8    17 Chanda    Boyer    1973-04-01 00:00:00 green         4
 9    11 Jordan    Estes    1969-12-07 00:00:00 indigo        4
10     2 Karen     Holcomb  1974-05-23 00:00:00 green         4
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">summarise</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">quantity</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 1]
  `mean(quantity)`
             &lt;dbl&gt;
1             3.22

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">mutate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prod</span><span class="o">=</span><span class="n">quantity</span><span class="o">*</span><span class="m">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 7]
      id firstname surname  birthdate           color  quantity  prod
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;
 1     1 Vivian    Hamilton 1971-07-08 00:00:00 green         1    10
 2     2 Karen     Holcomb  1974-05-23 00:00:00 green         4    40
 3     3 Cody      Garrett  1973-04-22 00:00:00 orange        1    10
 4     4 Roth      Fry      1975-01-29 00:00:00 black         1    10
 5     5 Zoe       Conway   1974-07-03 00:00:00 blue          2    20
 6     6 Gretchen  Kinney   1974-10-18 00:00:00 violet        1    10
 7     7 Driscoll  Klein    1970-10-05 00:00:00 blue          5    50
 8     8 Karyn     Diaz     1969-02-24 00:00:00 red           1    10
 9     9 Merritt   Guy      1974-10-17 00:00:00 indigo        4    40
10    10 Kylan     Sexton   1975-02-28 00:00:00 black         4    40
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">summarize</span><span class="p">(</span><span class="nf">group_by</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="nf">n</span><span class="p">(),</span> <span class="n">mean_quantity</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">quantity</span><span class="p">))</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 3]
  color  count mean_quantity
  &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;
1 blue       3           4
2 yellow     1           1
3 green      4           3.5
4 orange     2           3
5 black      2           2.5
6 indigo     2           4
7 violet     1           1
8 red        2           3
9 gray       1           5

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">cat</span><span class="p">(</span><span class="n">dbplyr</span><span class="o">::</span><span class="nf">sql_render</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SELECT `color`, count(*) AS `count`, AVG(`quantity`) AS `mean_quantity`
FROM `people`
GROUP BY `color`
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">count</span> <span class="o">=</span> <span class="nf">n</span><span class="p">(),</span> <span class="n">mean_quantity</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">quantity</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 3]
  color  count mean_quantity
  &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;
1 blue       3           4
2 yellow     1           1
3 green      4           3.5
4 orange     2           3
5 black      2           2.5
6 indigo     2           4
7 violet     1           1
8 red        2           3
9 gray       1           5

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">summarise</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">max</span><span class="p">(</span><span class="n">quantity</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 1]
  `max(quantity)`
            &lt;int&gt;
1               5

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>hdfs dfs -rm  -r -f /tmp/demo/
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="nf">spark_write_csv</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span> <span class="o">==</span> <span class="s">&#39;blue&#39;</span><span class="p">),</span>
                <span class="n">path</span><span class="o">=</span><span class="s">&#39;/tmp/demo/&#39;</span><span class="p">,</span>
                <span class="n">delimiter</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="p">,</span>
                <span class="n">quote</span> <span class="o">=</span> <span class="s">&#39;\&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>hdfs dfs -ls /tmp/demo/
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 2 items
-rw-r--r--   1 root supergroup          0 2019-07-30 21:44 /tmp/demo/_SUCCESS
-rw-r--r--   1 root supergroup        186 2019-07-30 21:44 /tmp/demo/part-00000-8186cc5d-f4c1-4edc-8c7f-d855c4dd7acc-c000.csv
</pre></div></div>
</div>
</div>
<div class="section" id="Ejemplos">
<h2>Ejemplos<a class="headerlink" href="#Ejemplos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los siguientes ejemplos son realizados usando el archivo <code class="docutils literal notranslate"><span class="pre">people.json</span></code> creado al principio de este tutorial.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">spark_read_csv</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span>                 <span class="c1"># spark_connection</span>
                     <span class="s">&#39;people&#39;</span><span class="p">,</span>           <span class="c1"># nombre de la tabla</span>
                     <span class="s">&#39;/tmp/people.csv&#39;</span><span class="p">)</span>  <span class="c1"># ubicación del archivo</span>
</pre></div>
</div>
</div>
<div class="section" id="Ejemplo-1">
<h3>Ejemplo 1<a class="headerlink" href="#Ejemplo-1" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Seleccione las personas cuya fecha de nacimiento sea del año 1974 en adelante.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Se usa la función filter() del DataFrame</span>
<span class="c1">##</span>
<span class="nf">filter</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">birthdate</span> <span class="o">&gt;=</span> <span class="s">&#39;1974&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 6]
     id firstname surname birthdate           color  quantity
  &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;dttm&gt;              &lt;chr&gt;     &lt;int&gt;
1     2 Karen     Holcomb 1974-05-23 00:00:00 green         4
2     4 Roth      Fry     1975-01-29 00:00:00 black         1
3     5 Zoe       Conway  1974-07-03 00:00:00 blue          2
4     6 Gretchen  Kinney  1974-10-18 00:00:00 violet        1
5     9 Merritt   Guy     1974-10-17 00:00:00 indigo        4
6    10 Kylan     Sexton  1975-02-28 00:00:00 black         4
7    16 Ayanna    Jarvis  1974-02-11 00:00:00 orange        5

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Se crea una vista temporal para ejecutar</span>
<span class="c1">## una consulta SQL sobre ella</span>
<span class="c1">##</span>
<span class="n">DBI</span><span class="o">::</span><span class="nf">dbGetQuery</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">&#39;SELECT * FROM people WHERE YEAR(birthdate) &gt;= 1974&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  id firstname surname  birthdate  color quantity
1  2     Karen Holcomb 1974-05-23  green        4
2  4      Roth     Fry 1975-01-29  black        1
3  5       Zoe  Conway 1974-07-03   blue        2
4  6  Gretchen  Kinney 1974-10-18 violet        1
5  9   Merritt     Guy 1974-10-17 indigo        4
6 10     Kylan  Sexton 1975-02-28  black        4
7 16    Ayanna  Jarvis 1974-02-11 orange        5

</pre></div></div>
</div>
</div>
<div class="section" id="Ejemplo-2">
<h3>Ejemplo 2<a class="headerlink" href="#Ejemplo-2" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Obtenga una lista de colores únicos.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Se usa la función distinct() del DataFrame</span>
<span class="c1">##</span>
<span class="nf">distinct</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 1]
  color
  &lt;chr&gt;
1 blue
2 yellow
3 green
4 orange
5 black
6 indigo
7 violet
8 red
9 gray

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Como una consulta</span>
<span class="c1">##</span>
<span class="n">DBI</span><span class="o">::</span><span class="nf">dbGetQuery</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">&#39;SELECT DISTINCT(color) FROM people&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   color
1   blue
2 yellow
3  green
4 orange
5  black
6 indigo
7 violet
8    red
9   gray

</pre></div></div>
</div>
</div>
<div class="section" id="Ejemplo-3">
<h3>Ejemplo 3<a class="headerlink" href="#Ejemplo-3" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Ordene la tabla por cantidad y luego por color.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Note que las funciones se aplican de derecha</span>
<span class="c1">## a izquierda -- este ejemplo no corre en sparkR</span>
<span class="c1">##</span>
<span class="nf">sdf_sort</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;quantity&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Source: spark&lt;?&gt; [?? x 6]
      id firstname surname  birthdate           color quantity
   &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;    &lt;int&gt;
 1     4 Roth      Fry      1975-01-29 00:00:00 black        1
 2    10 Kylan     Sexton   1975-02-28 00:00:00 black        4
 3     5 Zoe       Conway   1974-07-03 00:00:00 blue         2
 4     7 Driscoll  Klein    1970-10-05 00:00:00 blue         5
 5    15 Hope      Silva    1970-07-01 00:00:00 blue         5
 6    13 Vivian    Crane    1970-08-27 00:00:00 gray         5
 7     1 Vivian    Hamilton 1971-07-08 00:00:00 green        1
 8     2 Karen     Holcomb  1974-05-23 00:00:00 green        4
 9    17 Chanda    Boyer    1973-04-01 00:00:00 green        4
10    12 Hope      Coffey   1973-12-24 00:00:00 green        5
# … with more rows

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="n">R</span>
<span class="c1">##</span>
<span class="c1">## Como una consulta de SQL</span>
<span class="c1">##</span>
<span class="n">DBI</span><span class="o">::</span><span class="nf">dbGetQuery</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">&#39;SELECT * FROM people ORDER BY quantity, color&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   id firstname  surname  birthdate  color quantity
1   4      Roth      Fry 1975-01-29  black        1
2   1    Vivian Hamilton 1971-07-08  green        1
3   3      Cody  Garrett 1973-04-22 orange        1
4   8     Karyn     Diaz 1969-02-24    red        1
5   6  Gretchen   Kinney 1974-10-18 violet        1
6  18  Chadwick   Knight 1973-04-29 yellow        1
7   5       Zoe   Conway 1974-07-03   blue        2
8  10     Kylan   Sexton 1975-02-28  black        4
9   2     Karen  Holcomb 1974-05-23  green        4
10 17    Chanda    Boyer 1973-04-01  green        4
11  9   Merritt      Guy 1974-10-17 indigo        4
12 11    Jordan    Estes 1969-12-07 indigo        4
13  7  Driscoll    Klein 1970-10-05   blue        5
14 15      Hope    Silva 1970-07-01   blue        5
15 13    Vivian    Crane 1970-08-27   gray        5
16 12      Hope   Coffey 1973-12-24  green        5
17 16    Ayanna   Jarvis 1974-02-11 orange        5
18 14      Clio     Noel 1972-12-12    red        5

</pre></div></div>
</div>
<p><strong>Limpieza del directorio de trabajo</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>rm people.*
<span class="o">!</span>hdfs dfs -rm  -r -f /tmp/demo/
<span class="o">!</span>hdfs dfs -rm /tmp/people*
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Deleted /tmp/demo
Deleted /tmp/people.csv
Deleted /tmp/people.json
</pre></div></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Juan D. Velasquez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>