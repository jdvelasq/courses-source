

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Construcción de una CNN usando estimadores &mdash; documentación de --- Cursos --- - </title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="Generación de texto usando una RNN" href="../sequences/1-01-text-generation-rnn.html" />
    <link rel="prev" title="Boosted trees en TensorFlow" href="1-04-boosted-trees-understanding.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../redes-neuronales-con-tensorflow/content.html">Sesiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../redes-neuronales-con-tensorflow/course-info.html">Información del curso</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../redes-neuronales-con-tensorflow/programming-labs.html">Laboratorios de programación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../redes-neuronales-con-tensorflow/complement.html">Material Complementario</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a> &raquo;</li>
        
          <li><a href="../../../redes-neuronales-con-tensorflow/content.html">Sesiones</a> &raquo;</li>
        
      <li>Construcción de una CNN usando estimadores</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/notebooks/tensorflow/ml-at-production-scale/1-05-build-a-cnn-using-estimators.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Construcción-de-una-CNN-usando-estimadores">
<h1>Construcción de una CNN usando estimadores<a class="headerlink" href="#Construcción-de-una-CNN-usando-estimadores" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li><p><em>30 min</em> | Última modificación: Julio 12, 2019.</p></li>
</ul>
<div class="section" id="Preparación">
<h2>Preparación<a class="headerlink" href="#Preparación" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">tf</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Modelo">
<h2>Modelo<a class="headerlink" href="#Modelo" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cnn_model_fn</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Model function for CNN.&quot;&quot;&quot;</span>
    <span class="c1"># Input Layer</span>
    <span class="n">input_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Convolutional Layer #1</span>
    <span class="n">conv1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>

    <span class="c1"># Pooling Layer #1</span>
    <span class="n">pool1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">max_pooling2d</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">conv1</span><span class="p">,</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">strides</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Convolutional Layer #2 and Pooling Layer #2</span>
    <span class="n">conv2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">pool1</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">kernel_size</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>

    <span class="n">pool2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">max_pooling2d</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">conv2</span><span class="p">,</span>
        <span class="n">pool_size</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">strides</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Dense Layer</span>
    <span class="n">pool2_flat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="n">pool2</span><span class="p">,</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">64</span><span class="p">])</span>

    <span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">pool2_flat</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>

    <span class="n">dropout</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">dense</span><span class="p">,</span>
        <span class="n">rate</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
        <span class="n">training</span><span class="o">=</span><span class="n">mode</span> <span class="o">==</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">)</span>

    <span class="c1"># Logits Layer</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Generate predictions (for PREDICT and EVAL mode)</span>
        <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="c1"># Add `softmax_tensor` to the graph. It is used for PREDICT and by the</span>
        <span class="c1"># `logging_hook`.</span>
        <span class="s2">&quot;probabilities&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;softmax_tensor&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">EstimatorSpec</span><span class="p">(</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">predictions</span><span class="o">=</span><span class="n">predictions</span><span class="p">)</span>

    <span class="c1"># Calculate Loss (for both TRAIN and EVAL modes)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">sparse_softmax_cross_entropy</span><span class="p">(</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">logits</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span>

    <span class="c1"># Configure the Training Op (for TRAIN mode)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="n">train_op</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
            <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
            <span class="n">global_step</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">get_global_step</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">EstimatorSpec</span><span class="p">(</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
            <span class="n">train_op</span><span class="o">=</span><span class="n">train_op</span><span class="p">)</span>

    <span class="c1"># Add evaluation metrics (for EVAL mode)</span>
    <span class="n">eval_metric_ops</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">predictions</span><span class="o">=</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">EstimatorSpec</span><span class="p">(</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
        <span class="n">eval_metric_ops</span><span class="o">=</span><span class="n">eval_metric_ops</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Entrenamiento-y-evaluación">
<h2>Entrenamiento y evaluación<a class="headerlink" href="#Entrenamiento-y-evaluación" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Load training and eval data</span>
<span class="p">((</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">),</span>
 <span class="p">(</span><span class="n">eval_data</span><span class="p">,</span> <span class="n">eval_labels</span><span class="p">))</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

<span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">train_labels</span> <span class="o">=</span> <span class="n">train_labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># not required</span>

<span class="n">eval_data</span> <span class="o">=</span> <span class="n">eval_data</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">eval_labels</span> <span class="o">=</span> <span class="n">eval_labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># not required</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Creación-del-estimador">
<h2>Creación del estimador<a class="headerlink" href="#Creación-del-estimador" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create the Estimator</span>
<span class="n">mnist_classifier</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">Estimator</span><span class="p">(</span>
    <span class="n">model_fn</span><span class="o">=</span><span class="n">cnn_model_fn</span><span class="p">,</span>
    <span class="n">model_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/mnist_convnet_model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: Logging before flag parsing goes to stderr.
I0712 21:23:17.296927 140349469853504 estimator.py:1790] Using default config.
I0712 21:23:17.299389 140349469853504 estimator.py:209] Using config: {&#39;_model_dir&#39;: &#39;/tmp/mnist_convnet_model&#39;, &#39;_tf_random_seed&#39;: None, &#39;_save_summary_steps&#39;: 100, &#39;_save_checkpoints_steps&#39;: None, &#39;_save_checkpoints_secs&#39;: 600, &#39;_session_config&#39;: allow_soft_placement: true
graph_options {
  rewrite_options {
    meta_optimizer_iterations: ONE
  }
}
, &#39;_keep_checkpoint_max&#39;: 5, &#39;_keep_checkpoint_every_n_hours&#39;: 10000, &#39;_log_step_count_steps&#39;: 100, &#39;_train_distribute&#39;: None, &#39;_device_fn&#39;: None, &#39;_protocol&#39;: None, &#39;_eval_distribute&#39;: None, &#39;_experimental_distribute&#39;: None, &#39;_experimental_max_worker_delay_secs&#39;: None, &#39;_service&#39;: None, &#39;_cluster_spec&#39;: &lt;tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa5585eb2b0&gt;, &#39;_task_type&#39;: &#39;worker&#39;, &#39;_task_id&#39;: 0, &#39;_global_id_in_cluster&#39;: 0, &#39;_master&#39;: &#39;&#39;, &#39;_evaluation_master&#39;: &#39;&#39;, &#39;_is_chief&#39;: True, &#39;_num_ps_replicas&#39;: 0, &#39;_num_worker_replicas&#39;: 1}
</pre></div></div>
</div>
</div>
<div class="section" id="Hook">
<h2>Hook<a class="headerlink" href="#Hook" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set up logging for predictions</span>
<span class="n">tensors_to_log</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;probabilities&quot;</span><span class="p">:</span> <span class="s2">&quot;softmax_tensor&quot;</span><span class="p">}</span>

<span class="n">logging_hook</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">LoggingTensorHook</span><span class="p">(</span>
    <span class="n">tensors</span><span class="o">=</span><span class="n">tensors_to_log</span><span class="p">,</span> <span class="n">every_n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Entrenamiento-del-modelo">
<h2>Entrenamiento del modelo<a class="headerlink" href="#Entrenamiento-del-modelo" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Train the model</span>
<span class="n">train_input_fn</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">numpy_input_fn</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">train_data</span><span class="p">},</span>
    <span class="n">y</span><span class="o">=</span><span class="n">train_labels</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># train one step and display the probabilties</span>
<span class="n">mnist_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">input_fn</span><span class="o">=</span><span class="n">train_input_fn</span><span class="p">,</span>
    <span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hooks</span><span class="o">=</span><span class="p">[</span><span class="n">logging_hook</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
W0712 21:24:26.058290 140349469853504 deprecation.py:323] From /usr/local/lib/python3.6/dist-packages/tensorflow/python/training/training_util.py:236: Variable.initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
W0712 21:24:26.077720 140349469853504 deprecation.py:323] From /home/vagrant/.local/lib/python3.6/site-packages/tensorflow_estimator/python/estimator/inputs/queues/feeding_queue_runner.py:62: QueueRunner.__init__ (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
W0712 21:24:26.080062 140349469853504 deprecation.py:323] From /home/vagrant/.local/lib/python3.6/site-packages/tensorflow_estimator/python/estimator/inputs/queues/feeding_functions.py:500: add_queue_runner (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
I0712 21:24:26.093508 140349469853504 estimator.py:1145] Calling model_fn.
W0712 21:24:26.096682 140349469853504 deprecation.py:323] From &lt;ipython-input-4-87a3e3c16cda&gt;:12: conv2d (from tensorflow.python.layers.convolutional) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.keras.layers.Conv2D` instead.
W0712 21:24:26.099754 140349469853504 deprecation.py:506] From /usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0712 21:24:26.274361 140349469853504 deprecation.py:323] From &lt;ipython-input-4-87a3e3c16cda&gt;:18: max_pooling2d (from tensorflow.python.layers.pooling) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.MaxPooling2D instead.
W0712 21:24:26.390304 140349469853504 deprecation.py:323] From &lt;ipython-input-4-87a3e3c16cda&gt;:41: dense (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.dense instead.
W0712 21:24:26.617873 140349469853504 deprecation.py:323] From &lt;ipython-input-4-87a3e3c16cda&gt;:46: dropout (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.dropout instead.
W0712 21:24:26.700082 140349469853504 deprecation.py:323] From /usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: add_dispatch_support.&lt;locals&gt;.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
I0712 21:24:26.798053 140349469853504 estimator.py:1147] Done calling model_fn.
I0712 21:24:26.800694 140349469853504 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0712 21:24:26.902958 140349469853504 monitored_session.py:240] Graph was finalized.
I0712 21:24:26.961380 140349469853504 session_manager.py:500] Running local_init_op.
I0712 21:24:26.966780 140349469853504 session_manager.py:502] Done running local_init_op.
W0712 21:24:26.982620 140349469853504 deprecation.py:323] From /usr/local/lib/python3.6/dist-packages/tensorflow/python/training/monitored_session.py:875: start_queue_runners (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
I0712 21:24:27.133799 140349469853504 basic_session_run_hooks.py:606] Saving checkpoints for 0 into /tmp/mnist_convnet_model/model.ckpt.
I0712 21:24:27.497322 140349469853504 basic_session_run_hooks.py:262] probabilities = [[0.10961121 0.09788985 0.08604975 0.09616116 0.11028063 0.08574776
  0.09272332 0.11455206 0.11126465 0.09571958]
 [0.1270983  0.08333064 0.08273795 0.09631192 0.10369562 0.08915299
  0.1052957  0.09718987 0.11477648 0.10041052]
 [0.10911497 0.09078442 0.08514825 0.10774258 0.09800223 0.10817905
  0.09704731 0.10659519 0.10707949 0.09030656]
 [0.11815795 0.10009187 0.08938219 0.1025853  0.10449692 0.10521984
  0.0948371  0.09836067 0.10162918 0.08523904]
 [0.09736396 0.08980457 0.10025763 0.09846914 0.10739752 0.10213197
  0.10272325 0.10517128 0.10534256 0.09133816]
 [0.13623427 0.09035327 0.09303661 0.10157055 0.09014974 0.08931375
  0.09451056 0.11470822 0.10204684 0.08807613]
 [0.1134505  0.09861757 0.09195245 0.10232287 0.0975837  0.10904013
  0.08858406 0.11640713 0.09716644 0.0848752 ]
 [0.11815296 0.1052179  0.08531073 0.12215505 0.08135393 0.09142806
  0.10035326 0.10996173 0.09380828 0.0922581 ]
 [0.11104492 0.09687651 0.08430682 0.10470472 0.1099757  0.10429911
  0.09025573 0.11364818 0.10234462 0.08254369]
 [0.09336608 0.0924193  0.10170496 0.0926699  0.09223698 0.10989515
  0.09277695 0.11855952 0.11239096 0.09398021]
 [0.10332016 0.10733309 0.09415944 0.10157711 0.09569203 0.09695322
  0.09111253 0.10527515 0.11560041 0.08897689]
 [0.12339793 0.10427318 0.08459501 0.10033522 0.10273935 0.09447741
  0.09661627 0.10250424 0.09705976 0.09400162]
 [0.10847329 0.09225404 0.09832015 0.09750702 0.08158644 0.110794
  0.09919415 0.1180781  0.10946331 0.08432945]
 [0.12018402 0.0839562  0.08632802 0.11218565 0.11221905 0.10472522
  0.0858813  0.10611317 0.10860265 0.07980474]
 [0.11558232 0.10769701 0.08771931 0.09617481 0.09990066 0.10614407
  0.08827717 0.10419589 0.11006354 0.08424523]
 [0.1083472  0.09464489 0.08573389 0.09965906 0.09901974 0.09865231
  0.09839428 0.12204117 0.11187262 0.0816348 ]
 [0.12018669 0.08390856 0.08898711 0.10427218 0.10697151 0.09998931
  0.09567884 0.1119353  0.10461396 0.08345652]
 [0.12437245 0.10253411 0.09377334 0.08593512 0.08982799 0.10474706
  0.09467735 0.11241408 0.10720001 0.08451849]
 [0.12150905 0.09731069 0.0821396  0.09440395 0.10394361 0.098731
  0.09191129 0.09746195 0.11818369 0.09440522]
 [0.10349585 0.09127343 0.08633936 0.10175414 0.1038185  0.11021556
  0.09907964 0.10278513 0.11063855 0.09059978]
 [0.09544916 0.10131549 0.0848856  0.1068572  0.10967006 0.09945888
  0.0924318  0.11409787 0.10444814 0.09138577]
 [0.10746738 0.08808325 0.0871258  0.09914611 0.09895667 0.09452052
  0.09879029 0.11917817 0.11846998 0.08826181]
 [0.11082432 0.10615397 0.09433078 0.09834593 0.09361111 0.10097884
  0.09787257 0.10392599 0.09941028 0.09454627]
 [0.12679632 0.0980466  0.0832739  0.10190298 0.09970769 0.11511447
  0.09034022 0.10787939 0.09979918 0.07713925]
 [0.11684155 0.08893925 0.09051686 0.11213501 0.10462281 0.08697268
  0.0946854  0.11650591 0.10386112 0.08491945]
 [0.1209547  0.0912037  0.08727601 0.10123147 0.09507723 0.0937064
  0.08904631 0.11954657 0.11206399 0.08989365]
 [0.10021013 0.10720714 0.09119505 0.09992836 0.10402889 0.10790298
  0.08801385 0.10511671 0.11163926 0.08475757]
 [0.09848062 0.09822898 0.09328206 0.10348214 0.11375915 0.09433252
  0.09434321 0.09891639 0.11861038 0.0865646 ]
 [0.09875038 0.11393505 0.06933464 0.10839482 0.1058861  0.08843172
  0.09989127 0.11713504 0.11148617 0.08675486]
 [0.09777905 0.09621648 0.09533065 0.1138734  0.10221866 0.10027093
  0.10244496 0.10194479 0.09703444 0.09288668]
 [0.14039563 0.07748824 0.09995198 0.09821875 0.09858671 0.08567909
  0.09524141 0.1201222  0.09762618 0.08668979]
 [0.09972312 0.10393099 0.08759438 0.10070165 0.10693786 0.09611001
  0.08853451 0.10978369 0.10866988 0.09801388]
 [0.11621909 0.09164448 0.09378608 0.10254715 0.10225108 0.09950928
  0.09159464 0.10847673 0.11073761 0.08323386]
 [0.10320014 0.09742621 0.08691569 0.09977048 0.11133282 0.10284933
  0.09227452 0.10834915 0.10966665 0.088215  ]
 [0.10134824 0.100466   0.08827254 0.0990058  0.10821857 0.09371482
  0.10078697 0.10369281 0.1150771  0.08941717]
 [0.10668904 0.09133349 0.0976151  0.10954187 0.10263673 0.10908695
  0.08583017 0.11368307 0.09123027 0.09235331]
 [0.10774699 0.10891844 0.09646319 0.09380066 0.09920733 0.09803182
  0.09314819 0.11423331 0.10601682 0.08243323]
 [0.11791661 0.1060968  0.09005271 0.0879596  0.09394097 0.09290177
  0.10330633 0.10817566 0.09858368 0.10106581]
 [0.12191612 0.10506563 0.09491906 0.09347017 0.10164809 0.08982632
  0.09741557 0.10030307 0.10666026 0.08877575]
 [0.10495476 0.09605843 0.08048339 0.10082043 0.11609061 0.09948081
  0.10175813 0.11139195 0.10917839 0.0797831 ]
 [0.12619515 0.08592287 0.08206064 0.09905916 0.10923515 0.10994475
  0.07968248 0.11757328 0.11126491 0.07906172]
 [0.10322867 0.09216416 0.08939096 0.09646209 0.09739786 0.11840585
  0.09320289 0.1124739  0.11631434 0.08095934]
 [0.11813205 0.09427745 0.09312416 0.0984904  0.1000836  0.0943758
  0.09571192 0.09968133 0.11345673 0.09266653]
 [0.10706338 0.0918191  0.08913139 0.1032868  0.11037922 0.09994808
  0.08849565 0.10244453 0.1114516  0.09598027]
 [0.10497861 0.11106176 0.08643888 0.09328523 0.10031361 0.09804116
  0.0830834  0.1063114  0.11386005 0.10262593]
 [0.11766969 0.08559214 0.08786167 0.09687018 0.09913212 0.10154046
  0.09202074 0.11218264 0.11466072 0.09246954]
 [0.11023878 0.08713369 0.09328964 0.09810928 0.09892572 0.09626931
  0.08999576 0.1123257  0.11932084 0.09439132]
 [0.11700395 0.10793912 0.08503405 0.10785473 0.09025099 0.10810024
  0.09194884 0.09366485 0.11463059 0.08357266]
 [0.13152485 0.0918207  0.07880348 0.09210462 0.10627457 0.10138211
  0.10186373 0.10817756 0.1089065  0.07914191]
 [0.11512276 0.09419435 0.08207487 0.11390336 0.09165338 0.101477
  0.09558898 0.11577066 0.10427528 0.08593927]
 [0.11728633 0.09176262 0.08860204 0.09812164 0.09794715 0.0976848
  0.09659532 0.11042899 0.11765205 0.08391899]
 [0.11411653 0.09687656 0.08833052 0.0932257  0.10417943 0.10091005
  0.10706037 0.10942236 0.10011066 0.08576775]
 [0.11764614 0.08525717 0.08399555 0.10120882 0.10313416 0.0909389
  0.09940356 0.11599947 0.12205581 0.08036046]
 [0.10371498 0.09906217 0.0876392  0.11617781 0.10151544 0.10100524
  0.08657285 0.1026426  0.10630485 0.09536479]
 [0.12404232 0.08186307 0.10049272 0.11069705 0.08688798 0.10443717
  0.08586001 0.10936522 0.10604116 0.09031328]
 [0.1170111  0.10612798 0.0841408  0.10562126 0.1015783  0.10911141
  0.08579335 0.08908767 0.11487406 0.08665413]
 [0.10072654 0.10430283 0.09396093 0.10663398 0.11016232 0.09030605
  0.09161602 0.10547242 0.11737296 0.07944588]
 [0.11976143 0.10738885 0.09095017 0.09094702 0.08889238 0.09215795
  0.10262112 0.11788739 0.10228142 0.08711226]
 [0.13185333 0.08816506 0.0824307  0.10216425 0.09684352 0.10126181
  0.08524532 0.1200849  0.11155032 0.08040081]
 [0.10675094 0.09056734 0.09713611 0.10458649 0.09909907 0.10121372
  0.09098586 0.11091611 0.116335   0.08240931]
 [0.11935358 0.09710643 0.08211216 0.09319424 0.09631686 0.11259843
  0.10306318 0.10635619 0.09630795 0.093591  ]
 [0.10319522 0.09336983 0.09778871 0.1052643  0.09947919 0.09518187
  0.0985808  0.10487325 0.10826744 0.09399937]
 [0.1131832  0.08946205 0.10257072 0.09998461 0.09441668 0.10509373
  0.10411403 0.12029523 0.08960765 0.0812722 ]
 [0.09845981 0.09753405 0.09431309 0.09702593 0.10286313 0.09838397
  0.09391002 0.1104774  0.11072135 0.09631128]
 [0.11599645 0.09560396 0.08153552 0.09551766 0.10787606 0.10183799
  0.09395302 0.11170313 0.10896972 0.08700648]
 [0.1052831  0.09259152 0.09116689 0.10026246 0.11465478 0.09886509
  0.09863511 0.09999385 0.11049145 0.08805574]
 [0.10655483 0.09146843 0.09034879 0.10119098 0.11166383 0.10550717
  0.09970085 0.10963258 0.1019249  0.08200763]
 [0.09623329 0.1054306  0.09148445 0.10290699 0.09989967 0.09775763
  0.09130087 0.10934459 0.11765489 0.08798701]
 [0.12309426 0.08466568 0.08654497 0.10521375 0.10034644 0.1033367
  0.0898403  0.1143311  0.10552777 0.08709896]
 [0.11521653 0.09385717 0.09255638 0.10130334 0.09360056 0.09010558
  0.08816558 0.12092235 0.11165055 0.09262194]
 [0.14027216 0.09886225 0.09618925 0.10003854 0.10738614 0.09060659
  0.09071233 0.09765361 0.10136378 0.07691535]
 [0.10300817 0.09472271 0.09550127 0.09868699 0.10337491 0.09536812
  0.09310782 0.09961315 0.12404941 0.09256748]
 [0.09677262 0.10354102 0.09506428 0.09546708 0.10162809 0.09103256
  0.09804464 0.11468651 0.1142646  0.08949864]
 [0.12107147 0.09344097 0.08282911 0.08625551 0.10744476 0.10542974
  0.08152676 0.11999625 0.11084888 0.09115659]
 [0.11828209 0.10212348 0.0936401  0.08929246 0.11061313 0.09979691
  0.09126357 0.10155115 0.11261893 0.08081824]
 [0.10910511 0.08979779 0.09701668 0.08932932 0.11581218 0.09156138
  0.09057675 0.11517102 0.11455509 0.0870747 ]
 [0.10200167 0.10451913 0.09151497 0.099707   0.11593938 0.10035826
  0.08825724 0.10137516 0.10916775 0.08715954]
 [0.11001141 0.09136311 0.0932259  0.09689633 0.10025937 0.10140367
  0.0898848  0.10630431 0.11418128 0.0964698 ]
 [0.11365487 0.09701166 0.08484279 0.09431348 0.11012267 0.09870086
  0.10558753 0.1012278  0.10658805 0.08795036]
 [0.12541972 0.08963738 0.07930358 0.09988707 0.10978495 0.09690993
  0.09543071 0.1101542  0.10906821 0.08440419]
 [0.11290909 0.1046431  0.08651105 0.10093403 0.10198231 0.1017822
  0.09076279 0.11470678 0.10782649 0.07794215]
 [0.10178983 0.09987181 0.09237617 0.10139982 0.12059581 0.09964653
  0.08531021 0.09811668 0.10964953 0.09124353]
 [0.09775488 0.10211821 0.09227062 0.10350138 0.11057006 0.10022982
  0.08908325 0.10678513 0.11098953 0.08669707]
 [0.12069656 0.10511117 0.08837047 0.09694389 0.10279506 0.09662412
  0.09559662 0.10626494 0.09501576 0.09258139]
 [0.12017535 0.09686215 0.08926623 0.10235026 0.10403238 0.09466559
  0.09645864 0.10667786 0.09731574 0.09219581]
 [0.11559705 0.10344149 0.10207003 0.09583827 0.11484271 0.10040347
  0.08301407 0.09775407 0.09417309 0.09286571]
 [0.10861169 0.09719579 0.09487434 0.09674691 0.1101537  0.10101889
  0.09412338 0.10112377 0.10311759 0.09303392]
 [0.1064695  0.09727825 0.0929458  0.10559733 0.09510297 0.10089046
  0.09728733 0.11923465 0.10192132 0.0832724 ]
 [0.11197374 0.0864568  0.07936518 0.09543069 0.09666318 0.10793786
  0.09190051 0.127595   0.11472995 0.08794701]
 [0.12073907 0.10234649 0.08282449 0.10382757 0.08611184 0.09878862
  0.08977237 0.11535911 0.11363798 0.08659247]
 [0.1210523  0.09016552 0.09160563 0.09516016 0.10142398 0.10984088
  0.08918322 0.10855646 0.09762836 0.09538349]
 [0.10770162 0.10228579 0.08568389 0.10167982 0.10720114 0.09887776
  0.09024854 0.11969452 0.10462565 0.08200125]
 [0.10297697 0.10947833 0.09235744 0.09946113 0.09616151 0.10485614
  0.08660465 0.10197933 0.10644336 0.09968119]
 [0.11700649 0.09467697 0.08821403 0.09469393 0.09552325 0.09730314
  0.09092396 0.11040761 0.11170234 0.09954829]
 [0.12374529 0.09542687 0.08744082 0.10874706 0.09102871 0.09988101
  0.09552936 0.11054759 0.10299301 0.08466033]
 [0.10972905 0.09641746 0.10979358 0.1005101  0.09977781 0.10177051
  0.09638105 0.10137934 0.09881721 0.08542387]
 [0.11812746 0.09652554 0.09195175 0.10169397 0.10016788 0.09578225
  0.08531784 0.10228723 0.11246721 0.09567893]
 [0.12096413 0.09233747 0.07957872 0.10562802 0.11594752 0.09898404
  0.08605858 0.10438374 0.11285706 0.08326071]
 [0.11501157 0.0991366  0.09014016 0.10464557 0.10079665 0.08966966
  0.09766684 0.10449426 0.11122357 0.08721512]
 [0.10555943 0.10020757 0.09379647 0.10177974 0.10069466 0.10081376
  0.09722179 0.10607572 0.1067608  0.08709002]]
I0712 21:24:27.499634 140349469853504 basic_session_run_hooks.py:262] loss = 2.2856379, step = 1
I0712 21:24:27.503186 140349469853504 basic_session_run_hooks.py:606] Saving checkpoints for 1 into /tmp/mnist_convnet_model/model.ckpt.
I0712 21:24:27.625110 140349469853504 estimator.py:368] Loss for final step: 2.2856379.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;tensorflow_estimator.python.estimator.estimator.Estimator at 0x7fa5a52a7320&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mnist_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">input_fn</span><span class="o">=</span><span class="n">train_input_fn</span><span class="p">,</span>
    <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
I0712 21:24:55.215213 140349469853504 estimator.py:1145] Calling model_fn.
I0712 21:24:55.468513 140349469853504 estimator.py:1147] Done calling model_fn.
I0712 21:24:55.471066 140349469853504 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0712 21:24:55.552362 140349469853504 monitored_session.py:240] Graph was finalized.
W0712 21:24:55.555237 140349469853504 deprecation.py:323] From /usr/local/lib/python3.6/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0712 21:24:55.558950 140349469853504 saver.py:1280] Restoring parameters from /tmp/mnist_convnet_model/model.ckpt-1
W0712 21:24:55.585066 140349469853504 deprecation.py:323] From /usr/local/lib/python3.6/dist-packages/tensorflow/python/training/saver.py:1066: get_checkpoint_mtimes (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file utilities to get mtimes.
I0712 21:24:55.603701 140349469853504 session_manager.py:500] Running local_init_op.
I0712 21:24:55.608353 140349469853504 session_manager.py:502] Done running local_init_op.
I0712 21:24:55.760722 140349469853504 basic_session_run_hooks.py:606] Saving checkpoints for 1 into /tmp/mnist_convnet_model/model.ckpt.
I0712 21:24:55.983818 140349469853504 basic_session_run_hooks.py:262] loss = 2.288118, step = 2
I0712 21:25:05.207075 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 10.8417
I0712 21:25:05.210214 140349469853504 basic_session_run_hooks.py:260] loss = 2.2873864, step = 102 (9.226 sec)
I0712 21:25:14.178257 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 11.1468
I0712 21:25:14.179910 140349469853504 basic_session_run_hooks.py:260] loss = 2.2616715, step = 202 (8.970 sec)
I0712 21:25:24.184398 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 9.99387
I0712 21:25:24.186323 140349469853504 basic_session_run_hooks.py:260] loss = 2.2392313, step = 302 (10.006 sec)
I0712 21:25:34.700889 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 9.50889
I0712 21:25:34.703511 140349469853504 basic_session_run_hooks.py:260] loss = 2.2232282, step = 402 (10.517 sec)
I0712 21:25:46.209876 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 8.68884
I0712 21:25:46.211426 140349469853504 basic_session_run_hooks.py:260] loss = 2.1922574, step = 502 (11.508 sec)
I0712 21:25:57.639411 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 8.74926
I0712 21:25:57.640954 140349469853504 basic_session_run_hooks.py:260] loss = 2.1430168, step = 602 (11.430 sec)
I0712 21:26:10.227896 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 7.94377
I0712 21:26:10.229527 140349469853504 basic_session_run_hooks.py:260] loss = 2.0936613, step = 702 (12.589 sec)
I0712 21:26:24.158059 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 7.17866
I0712 21:26:24.161348 140349469853504 basic_session_run_hooks.py:260] loss = 2.0630476, step = 802 (13.932 sec)
I0712 21:26:36.998361 140349469853504 basic_session_run_hooks.py:692] global_step/sec: 7.78804
I0712 21:26:37.000688 140349469853504 basic_session_run_hooks.py:260] loss = 1.9399314, step = 902 (12.839 sec)
I0712 21:26:49.116272 140349469853504 basic_session_run_hooks.py:606] Saving checkpoints for 1001 into /tmp/mnist_convnet_model/model.ckpt.
I0712 21:26:49.194988 140349469853504 estimator.py:368] Loss for final step: 1.8166099.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;tensorflow_estimator.python.estimator.estimator.Estimator at 0x7fa5a52a7320&gt;
</pre></div></div>
</div>
</div>
<div class="section" id="Evaluación-del-modelo">
<h2>Evaluación del modelo<a class="headerlink" href="#Evaluación-del-modelo" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">eval_input_fn</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">numpy_input_fn</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">eval_data</span><span class="p">},</span>
    <span class="n">y</span><span class="o">=</span><span class="n">eval_labels</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">eval_results</span> <span class="o">=</span> <span class="n">mnist_classifier</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">input_fn</span><span class="o">=</span><span class="n">eval_input_fn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">eval_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
I0712 21:26:58.943718 140349469853504 estimator.py:1145] Calling model_fn.
I0712 21:26:59.050471 140349469853504 estimator.py:1147] Done calling model_fn.
I0712 21:26:59.072779 140349469853504 evaluation.py:255] Starting evaluation at 2019-07-12T21:26:59Z
I0712 21:26:59.154744 140349469853504 monitored_session.py:240] Graph was finalized.
I0712 21:26:59.157262 140349469853504 saver.py:1280] Restoring parameters from /tmp/mnist_convnet_model/model.ckpt-1001
I0712 21:26:59.195664 140349469853504 session_manager.py:500] Running local_init_op.
I0712 21:26:59.205178 140349469853504 session_manager.py:502] Done running local_init_op.
I0712 21:27:01.352412 140349469853504 evaluation.py:275] Finished evaluation at 2019-07-12-21:27:01
I0712 21:27:01.353321 140349469853504 estimator.py:2039] Saving dict for global step 1001: accuracy = 0.7254, global_step = 1001, loss = 1.8175361
I0712 21:27:01.385889 140349469853504 estimator.py:2099] Saving &#39;checkpoint_path&#39; summary for global step 1001: /tmp/mnist_convnet_model/model.ckpt-1001
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;accuracy&#39;: 0.7254, &#39;loss&#39;: 1.8175361, &#39;global_step&#39;: 1001}
</pre></div></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Juan D. Velasquez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>