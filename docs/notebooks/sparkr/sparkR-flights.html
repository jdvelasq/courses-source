

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Análisis de datos usando SparkR &mdash; documentación de --- Cursos --- - </title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="Predicción de gastos médicos en SparkR" href="sparkR-regression.html" />
    <link rel="prev" title="Segmentación del mercado de adolecentes en SparkR" href="sparkR-clustering.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> --- Cursos ---
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuración</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Instalación de Vagrant y Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Cursos</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../analitica-de-grandes-datos/content.html">Sesiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/grades.html">Laboratorios de Programación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analitica-de-grandes-datos/course-info.html">Información del curso</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-financiera/index.html">Analítica Financiera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analitica-predictiva/index.html">Analítica Predictiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ciencia-de-los-datos/index.html">Ciencia de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fundamentos-de-analitica/index.html">Fundamentos de Analítica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../productos-de-datos/index.html">Productos de Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../redes-neuronales-con-tensorflow/index.html">Redes Neuronales Artificiales</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">--- Cursos ---</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/index.html">Analítica de grandes datos</a> &raquo;</li>
        
          <li><a href="../../analitica-de-grandes-datos/content.html">Sesiones</a> &raquo;</li>
        
      <li>Análisis de datos usando SparkR</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/sparkr/sparkR-flights.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Análisis-de-datos-usando-SparkR">
<h1>Análisis de datos usando SparkR<a class="headerlink" href="#Análisis-de-datos-usando-SparkR" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li><p><em>30 min</em> | Última modificación: Junio 22, 2019</p></li>
</ul>
<p>En este tutorial se presenta el análisis de una base de datos sobre vuelos usando SQL en Spark desde la interfaz de R. En este documento se ejemplifica el uso de DataFrames para la realización de consultas usando sus funciones nativas, como también el envio de comandos SQL. Adicionalmente, se demuestra como salvar los resultados al HDFS en distintos formatos.</p>
<p>Al finalizar este documento, el lector estará en capacidad de:</p>
<ul class="simple">
<li><p>Mover archivos entre el HDFS y el sistema local.</p></li>
<li><p>Importar tablas en formato CSV a SparkR.</p></li>
<li><p>Aplicar operadores de selección, filtrado y agregación desde R.</p></li>
<li><p>Usar los resultados obtenidos para construir gráficos.</p></li>
<li><p>Exportar los resultados a archivos en el sistema HDFS.</p></li>
</ul>
<p>Este ejemplo está basado en el tutorial de Spark de HortoWorks, disponible en <a class="reference external" href="https://es.hortonworks.com/tutorial/learning-spark-sql-with-zeppelin/">https://es.hortonworks.com/tutorial/learning-spark-sql-with-zeppelin/</a></p>
<p>En este tutorial se ejemplican los mismos comandos usados en el tutorial “Análisis de datos usando PySpark”, por lo que aquí solo se ilustra la sintaxis usada; para obtener información detallada, debe verse el tutorial citado.</p>
<div class="section" id="Preparación">
<h2>Preparación<a class="headerlink" href="#Preparación" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Esta función se usará para ejecutar comandos en el</span>
<span class="c1">## sistema operativo y capturar la salida.</span>
<span class="c1">##</span>
<span class="n">systemp</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="nf">cat</span><span class="p">(</span><span class="nf">system</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">intern</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">library</span><span class="p">(</span><span class="n">SparkR</span><span class="p">)</span>
<span class="nf">sparkR.session</span><span class="p">(</span><span class="n">enableHiveSupport</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

Attaching package: ‘SparkR’

The following objects are masked from ‘package:stats’:

    cov, filter, lag, na.omit, predict, sd, var, window

The following objects are masked from ‘package:base’:

    as.data.frame, colnames, colnames&lt;-, drop, endsWith, intersect,
    rank, rbind, sample, startsWith, subset, summary, transform, union

Spark package found in SPARK_HOME: /usr/local/spark-2.4.0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Launching java with spark-submit command /usr/local/spark-2.4.0/bin/spark-submit   sparkr-shell /tmp/RtmpshPvjt/backend_portb80694bda87
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Warning message in sparkR.session(enableHiveSupport = TRUE):
“Version mismatch between Spark JVM and SparkR package. JVM version was 2.4.0 , while R package version was 2.4.3”
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Java ref type org.apache.spark.sql.SparkSession id 1
</pre></div></div>
</div>
</div>
<div class="section" id="Copia-de-archivos-al-HDFS">
<h2>Copia de archivos al HDFS<a class="headerlink" href="#Copia-de-archivos-al-HDFS" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## El archivo flights.csv se encuentra en la capeta de</span>
<span class="c1">## trabajo de la máquina local. Se copia el archivo</span>
<span class="c1">## a la carpeta /tmp del sistema HDFS.</span>
<span class="c1">##</span>
<span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;hdfs dfs -copyFromLocal flights.csv /tmp/&#39;</span><span class="p">)</span>

<span class="c1">##</span>
<span class="c1">## Se listan los archivos en la carpeta /tmp del HDFS</span>
<span class="c1">## para verificar que el archivo haya sido copiado</span>
<span class="c1">##</span>
<span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;hdfs dfs -ls /tmp/*csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

-rw-r--r--   1 vagrant supergroup    9719582 2019-05-20 23:36 /tmp/flights.csv
</pre></div></div>
</div>
</div>
<div class="section" id="Carga-de-datos-en-Spark">
<h2>Carga de datos en Spark<a class="headerlink" href="#Carga-de-datos-en-Spark" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Crea un DataFrame a partir del archivo fligths.csv</span>
<span class="c1">##</span>
<span class="n">flights</span> <span class="o">&lt;-</span> <span class="nf">read.df</span><span class="p">(</span><span class="s">&quot;/tmp/flights.csv&quot;</span><span class="p">,</span>
                   <span class="s">&quot;csv&quot;</span><span class="p">,</span>
                   <span class="n">header</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se imprime el esquema para verificar la lectura</span>
<span class="c1">## del archivo.</span>
<span class="c1">##</span>
<span class="nf">printSchema</span><span class="p">(</span><span class="n">flights</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
root
 |-- Year: string (nullable = true)
 |-- Month: string (nullable = true)
 |-- DayofMonth: string (nullable = true)
 |-- DayOfWeek: string (nullable = true)
 |-- DepTime: string (nullable = true)
 |-- CRSDepTime: string (nullable = true)
 |-- ArrTime: string (nullable = true)
 |-- CRSArrTime: string (nullable = true)
 |-- UniqueCarrier: string (nullable = true)
 |-- FlightNum: string (nullable = true)
 |-- TailNum: string (nullable = true)
 |-- ActualElapsedTime: string (nullable = true)
 |-- CRSElapsedTime: string (nullable = true)
 |-- AirTime: string (nullable = true)
 |-- ArrDelay: string (nullable = true)
 |-- DepDelay: string (nullable = true)
 |-- Origin: string (nullable = true)
 |-- Dest: string (nullable = true)
 |-- Distance: string (nullable = true)
 |-- TaxiIn: string (nullable = true)
 |-- TaxiOut: string (nullable = true)
 |-- Cancelled: string (nullable = true)
 |-- CancellationCode: string (nullable = true)
 |-- Diverted: string (nullable = true)
 |-- CarrierDelay: string (nullable = true)
 |-- WeatherDelay: string (nullable = true)
 |-- NASDelay: string (nullable = true)
 |-- SecurityDelay: string (nullable = true)
 |-- LateAircraftDelay: string (nullable = true)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se imprime un subconjunto de las columnas para verificar</span>
<span class="c1">## la lectura</span>
<span class="c1">##</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="s">&#39;UniqueCarrier&#39;</span><span class="p">,</span> <span class="s">&#39;FlightNum&#39;</span><span class="p">,</span> <span class="s">&#39;DepDelay&#39;</span><span class="p">,</span> <span class="s">&#39;ArrDelay&#39;</span><span class="p">,</span> <span class="s">&#39;Distance&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 6 × 5</caption>
<thead>
    <tr><th scope=col>UniqueCarrier</th><th scope=col>FlightNum</th><th scope=col>DepDelay</th><th scope=col>ArrDelay</th><th scope=col>Distance</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>WN</td><td>335 </td><td>8 </td><td>-14</td><td>810</td></tr>
    <tr><td>WN</td><td>3231</td><td>19</td><td>2  </td><td>810</td></tr>
    <tr><td>WN</td><td>448 </td><td>8 </td><td>14 </td><td>515</td></tr>
    <tr><td>WN</td><td>1746</td><td>-4</td><td>-6 </td><td>515</td></tr>
    <tr><td>WN</td><td>3920</td><td>34</td><td>34 </td><td>515</td></tr>
    <tr><td>WN</td><td>378 </td><td>25</td><td>11 </td><td>688</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Número total de registros leidos</span>
<span class="c1">##</span>
<span class="n">numTotalFlights</span> <span class="o">&lt;-</span> <span class="nf">count</span><span class="p">(</span><span class="n">flights</span><span class="p">)</span>
<span class="n">numTotalFlights</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
1e+05</div>
</div>
</div>
<div class="section" id="Cálculos-usando-funciones-de-los-DataFrames">
<h2>Cálculos usando funciones de los DataFrames<a class="headerlink" href="#Cálculos-usando-funciones-de-los-DataFrames" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="Cómputo-del-porcentaje-de-vuelos-retrasados">
<h3>Cómputo del porcentaje de vuelos retrasados<a class="headerlink" href="#Cómputo-del-porcentaje-de-vuelos-retrasados" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## La variable delayedFlights contiene las columnas</span>
<span class="c1">## UniqueCarrier y DepDelay para los vuelos con</span>
<span class="c1">## DepDelay &gt; 15 minutos.</span>
<span class="c1">##</span>
<span class="n">delayedFlights</span> <span class="o">&lt;-</span> <span class="nf">select</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">flights</span><span class="o">$</span><span class="n">DepDelay</span> <span class="o">&gt;</span> <span class="m">15</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;UniqueCarrier&#39;</span><span class="p">,</span> <span class="s">&#39;DepDelay&#39;</span><span class="p">))</span>
<span class="nf">head</span><span class="p">(</span><span class="n">delayedFlights</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 6 × 2</caption>
<thead>
    <tr><th scope=col>UniqueCarrier</th><th scope=col>DepDelay</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>WN</td><td>19</td></tr>
    <tr><td>WN</td><td>34</td></tr>
    <tr><td>WN</td><td>25</td></tr>
    <tr><td>WN</td><td>67</td></tr>
    <tr><td>WN</td><td>94</td></tr>
    <tr><td>WN</td><td>27</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Porcentaje de vuelos retrasados.</span>
<span class="c1">##</span>
<span class="n">numDelayedFlights</span> <span class="o">&lt;-</span> <span class="nf">count</span><span class="p">(</span><span class="n">delayedFlights</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Porcentaje de vuelos retrasados: &quot;</span><span class="p">,</span> <span class="n">numDelayedFlights</span> <span class="o">/</span> <span class="n">numTotalFlights</span> <span class="o">*</span> <span class="m">100</span><span class="p">,</span> <span class="s">&quot;%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Porcentaje de vuelos retrasados:  19.587 %
</pre></div></div>
</div>
</div>
<div class="section" id="Creación-de-campos">
<h3>Creación de campos<a class="headerlink" href="#Creación-de-campos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A continuación se desea crear una nueva columna llamada <code class="docutils literal notranslate"><span class="pre">IsDelayed</span></code> que vale 0 si el vuelo se realizó a tiempo y 1 si se retraso.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Selecciona algunos campos del DataFrame original</span>
<span class="c1">##</span>
<span class="n">flightsWithDelays</span> <span class="o">&lt;-</span> <span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Year&#39;</span><span class="p">,</span>
                                       <span class="s">&#39;Month&#39;</span><span class="p">,</span>
                                       <span class="s">&#39;DayofMonth&#39;</span><span class="p">,</span>
                                       <span class="s">&#39;UniqueCarrier&#39;</span><span class="p">,</span>
                                       <span class="s">&#39;FlightNum&#39;</span><span class="p">,</span>
                                       <span class="s">&#39;DepDelay&#39;</span><span class="p">))</span>

<span class="c1">##</span>
<span class="c1">## Crea un nuevo campo, como computo de otro existente</span>
<span class="c1">##</span>
<span class="n">flightsWithDelays</span><span class="o">$</span><span class="n">IsDelayed</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">flightsWithDelays</span><span class="o">$</span><span class="n">DepDelay</span> <span class="o">&gt;</span> <span class="m">15</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>


<span class="c1">##</span>
<span class="c1">## Se imprimen algunos registros para verificar el resultado.</span>
<span class="c1">##</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flightsWithDelays</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;DepDelay&#39;</span><span class="p">,</span> <span class="s">&#39;isDelayed&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 6 × 2</caption>
<thead>
    <tr><th scope=col>DepDelay</th><th scope=col>isDelayed</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>8 </td><td>0</td></tr>
    <tr><td>19</td><td>1</td></tr>
    <tr><td>8 </td><td>0</td></tr>
    <tr><td>-4</td><td>0</td></tr>
    <tr><td>34</td><td>1</td></tr>
    <tr><td>25</td><td>1</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## A continuación, se calcula el porcentaje de vuelos con retrasos</span>
<span class="c1">##</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">agg</span><span class="p">(</span><span class="n">flightsWithDelays</span><span class="p">,</span> <span class="nf">sum</span><span class="p">(</span><span class="n">flightsWithDelays</span><span class="o">$</span><span class="n">IsDelayed</span><span class="p">)</span> <span class="o">/</span> <span class="nf">n</span><span class="p">(</span><span class="n">flightsWithDelays</span><span class="o">$</span><span class="n">DepDelay</span><span class="p">)))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 1 × 1</caption>
<thead>
    <tr><th scope=col>(sum(IsDelayed) / count(DepDelay))</th></tr>
    <tr><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>0.1981327</td></tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div class="section" id="Cómputos-usando-SQL">
<h2>Cómputos usando SQL<a class="headerlink" href="#Cómputos-usando-SQL" title="Enlazar permanentemente con este título">¶</a></h2>
<p>A continuación se realizan los mismos cálculos anteriores, pero usando SQL desde Spark.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se crea la tabla</span>
<span class="c1">##</span>
<span class="n">flights</span><span class="o">$</span><span class="n">IsDelayed</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">DepDelay</span> <span class="o">&gt;</span> <span class="m">15</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
<span class="nf">createOrReplaceTempView</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="s">&#39;flightsView&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Numero total de retrasos por transportador</span>
<span class="c1">##</span>
<span class="nf">head</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s">SELECT</span>
<span class="s">    UniqueCarrier,</span>
<span class="s">    SUM(IsDelayed) AS NumDelays</span>
<span class="s">FROM</span>
<span class="s">    flightsView</span>
<span class="s">GROUP BY</span>
<span class="s">    UniqueCarrier</span>
<span class="s">&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th scope=col>UniqueCarrier</th><th scope=col>NumDelays</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>XE</td><td> 1014</td></tr>
    <tr><td>WN</td><td>18573</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Gráfico</span>
<span class="c1">##</span>
<span class="n">result</span> <span class="o">&lt;-</span> <span class="nf">collect</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s">SELECT</span>
<span class="s">    UniqueCarrier,</span>
<span class="s">    SUM(IsDelayed) AS NumDelays</span>
<span class="s">FROM</span>
<span class="s">    flightsView</span>
<span class="s">GROUP BY</span>
<span class="s">    UniqueCarrier</span>
<span class="s">&quot;</span><span class="p">))</span>

<span class="nf">barplot</span><span class="p">(</span><span class="n">result</span><span class="o">$</span><span class="n">NumDelays</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_sparkr_sparkR-flights_26_0.png" src="../../_images/notebooks_sparkr_sparkR-flights_26_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Tiempo total de retrasos por transportador</span>
<span class="c1">##</span>
<span class="nf">collect</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s">SELECT</span>
<span class="s">    UniqueCarrier,</span>
<span class="s">    SUM(DepDelay) AS TotalTimeDelay</span>
<span class="s">FROM</span>
<span class="s">    flightsView</span>
<span class="s">GROUP BY</span>
<span class="s">    UniqueCarrier</span>
<span class="s">&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th scope=col>UniqueCarrier</th><th scope=col>TotalTimeDelay</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>XE</td><td> 47505</td></tr>
    <tr><td>WN</td><td>978547</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Distancia recorrida por operador</span>
<span class="c1">##</span>
<span class="nf">collect</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s">SELECT</span>
<span class="s">    UniqueCarrier,</span>
<span class="s">    avg(Distance) AS AvgDistanceTraveled</span>
<span class="s">FROM</span>
<span class="s">    flightsView</span>
<span class="s">GROUP BY</span>
<span class="s">    UniqueCarrier</span>
<span class="s">ORDER BY</span>
<span class="s">    AvgDistanceTraveled DESC</span>
<span class="s">&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th scope=col>UniqueCarrier</th><th scope=col>AvgDistanceTraveled</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>XE</td><td>738.0678</td></tr>
    <tr><td>WN</td><td>623.7927</td></tr>
</tbody>
</table></div>
</div>
<div class="section" id="Retrasos-por-día-de-la-semana">
<h3>Retrasos por día de la semana<a class="headerlink" href="#Retrasos-por-día-de-la-semana" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">head</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s">SELECT</span>
<span class="s">    DayOfWeek,</span>
<span class="s">    delayed,</span>
<span class="s">    COUNT(1) AS Count</span>
<span class="s">FROM</span>
<span class="s">    (SELECT</span>
<span class="s">        DayOfWeek,</span>
<span class="s">        IsDelayed AS delayed</span>
<span class="s">     FROM</span>
<span class="s">        flightsView)</span>
<span class="s">GROUP BY</span>
<span class="s">    DayOfWeek,</span>
<span class="s">    delayed</span>
<span class="s">ORDER BY</span>
<span class="s">    DayOfWeek</span>
<span class="s">&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 6 × 3</caption>
<thead>
    <tr><th scope=col>DayOfWeek</th><th scope=col>delayed</th><th scope=col>Count</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>1</td><td>0</td><td>11863</td></tr>
    <tr><td>1</td><td>1</td><td> 2656</td></tr>
    <tr><td>2</td><td>0</td><td>12911</td></tr>
    <tr><td>2</td><td>1</td><td> 1799</td></tr>
    <tr><td>3</td><td>1</td><td> 1434</td></tr>
    <tr><td>3</td><td>0</td><td>13260</td></tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="Retrasos-por-hora-del-día">
<h3>Retrasos por hora del día<a class="headerlink" href="#Retrasos-por-hora-del-día" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">head</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;</span>
<span class="s">SELECT</span>
<span class="s">    Hour,</span>
<span class="s">    delayed,</span>
<span class="s">    COUNT(1) AS Count</span>
<span class="s">FROM</span>
<span class="s">(</span>
<span class="s">    SELECT</span>
<span class="s">        CAST(CRSDepTime / 100 AS INT) AS Hour,</span>
<span class="s">        IsDelayed AS delayed</span>
<span class="s">    FROM</span>
<span class="s">        flightsView</span>
<span class="s">)</span>
<span class="s">GROUP BY</span>
<span class="s">    Hour,</span>
<span class="s">    delayed</span>
<span class="s">ORDER BY</span>
<span class="s">    Hour</span>
<span class="s">&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 6 × 3</caption>
<thead>
    <tr><th scope=col>Hour</th><th scope=col>delayed</th><th scope=col>Count</th></tr>
    <tr><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>6</td><td>1</td><td> 208</td></tr>
    <tr><td>6</td><td>0</td><td>6126</td></tr>
    <tr><td>7</td><td>1</td><td> 372</td></tr>
    <tr><td>7</td><td>0</td><td>7274</td></tr>
    <tr><td>8</td><td>1</td><td> 547</td></tr>
    <tr><td>8</td><td>0</td><td>5956</td></tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div class="section" id="Almacenamiento-y-lectura-de-tablas-calculadas">
<h2>Almacenamiento y lectura de tablas calculadas<a class="headerlink" href="#Almacenamiento-y-lectura-de-tablas-calculadas" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="Escritura-de-resultados-en-el-HDFS-con-formato-ORC">
<h3>Escritura de resultados en el HDFS con formato ORC<a class="headerlink" href="#Escritura-de-resultados-en-el-HDFS-con-formato-ORC" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se salva la tabla calculada al directorio tmp del HDFS.</span>
<span class="c1">## Primero se borra si existe.</span>
<span class="c1">##</span>
<span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;hdfs dfs -rm -r -f /tmp/flightsWithDelays.orc&#39;</span><span class="p">)</span>

<span class="c1">## Se salva en formato ORC</span>
<span class="nf">write.orc</span><span class="p">(</span><span class="n">flightsWithDelays</span><span class="p">,</span> <span class="s">&quot;/tmp/flightsWithDelays.orc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Deleted /tmp/flightsWithDelays.orc
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Contenido del directorio donde se salvó la tabla</span>
<span class="c1">##</span>
<span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;hdfs dfs -ls /tmp/flightsWithDelays.orc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found 3 items
-rw-r--r--   1 vagrant supergroup          0 2019-05-20 23:37 /tmp/flightsWithDelays.orc/_SUCCESS
-rw-r--r--   1 vagrant supergroup     204828 2019-05-20 23:37 /tmp/flightsWithDelays.orc/part-00000-6411fb20-af57-4a81-b21e-b3653adb85d7-c000.snappy.orc
-rw-r--r--   1 vagrant supergroup      92419 2019-05-20 23:37 /tmp/flightsWithDelays.orc/part-00001-6411fb20-af57-4a81-b21e-b3653adb85d7-c000.snappy.orc
</pre></div></div>
</div>
</div>
<div class="section" id="Carga-de-los-resultados-desde-el-HDFS">
<h3>Carga de los resultados desde el HDFS<a class="headerlink" href="#Carga-de-los-resultados-desde-el-HDFS" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Se lee la tabla calculada desde el HDFS</span>
<span class="c1">##</span>
<span class="n">test</span> <span class="o">&lt;-</span> <span class="nf">read.orc</span><span class="p">(</span><span class="s">&quot;/tmp/flightsWithDelays.orc&quot;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 6 × 7</caption>
<thead>
    <tr><th scope=col>Year</th><th scope=col>Month</th><th scope=col>DayofMonth</th><th scope=col>UniqueCarrier</th><th scope=col>FlightNum</th><th scope=col>DepDelay</th><th scope=col>IsDelayed</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2008</td><td>1</td><td>3</td><td>WN</td><td>335 </td><td>8 </td><td>0</td></tr>
    <tr><td>2008</td><td>1</td><td>3</td><td>WN</td><td>3231</td><td>19</td><td>1</td></tr>
    <tr><td>2008</td><td>1</td><td>3</td><td>WN</td><td>448 </td><td>8 </td><td>0</td></tr>
    <tr><td>2008</td><td>1</td><td>3</td><td>WN</td><td>1746</td><td>-4</td><td>0</td></tr>
    <tr><td>2008</td><td>1</td><td>3</td><td>WN</td><td>3920</td><td>34</td><td>1</td></tr>
    <tr><td>2008</td><td>1</td><td>3</td><td>WN</td><td>378 </td><td>25</td><td>1</td></tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="Salva-el-DataFrame-como-una-tabla-permamente">
<h3>Salva el DataFrame como una tabla permamente<a class="headerlink" href="#Salva-el-DataFrame-como-una-tabla-permamente" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## La tabla queda guardada en la carpeta</span>
<span class="c1">## spark-warehouse del directorio actual</span>
<span class="c1">##</span>
<span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;rm -rf spark-warehouse/flightswithdelaystbl&#39;</span><span class="p">)</span>
<span class="nf">saveAsTable</span><span class="p">(</span><span class="n">flightsWithDelays</span><span class="p">,</span> <span class="s">&quot;flightswithdelaystbl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
</div>
<div class="section" id="Tablas-almacenadas">
<h3>Tablas almacenadas<a class="headerlink" href="#Tablas-almacenadas" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">collect</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;SHOW TABLES&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 2 × 3</caption>
<thead>
    <tr><th scope=col>database</th><th scope=col>tableName</th><th scope=col>isTemporary</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;lgl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>default</td><td>flightswithdelaystbl</td><td>FALSE</td></tr>
    <tr><td>       </td><td>flightsview         </td><td> TRUE</td></tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div class="section" id="Consultas-en-un-tabla-permanente">
<h2>Consultas en un tabla permanente<a class="headerlink" href="#Consultas-en-un-tabla-permanente" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##</span>
<span class="c1">## Note que cuando la tabla está almacenada de forma</span>
<span class="c1">## permanente no es necesario cargarla a la memoria</span>
<span class="c1">## para poder usarla.</span>
<span class="c1">##</span>
<span class="nf">collect</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;SELECT COUNT(1) AS Total from flightswithdelaystbl&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 1 × 1</caption>
<thead>
    <tr><th scope=col>Total</th></tr>
    <tr><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>1e+05</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## Se borran las tablas para limpiar el área</span>
<span class="c1">## de trabajo.</span>
<span class="nf">sql</span><span class="p">(</span><span class="s">&quot;DROP TABLE flightswithdelaystbl&quot;</span><span class="p">)</span>
<span class="nf">collect</span><span class="p">(</span><span class="nf">sql</span><span class="p">(</span><span class="s">&quot;SHOW TABLES&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SparkDataFrame[]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<table>
<caption>A data.frame: 1 × 3</caption>
<thead>
    <tr><th scope=col>database</th><th scope=col>tableName</th><th scope=col>isTemporary</th></tr>
    <tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;lgl&gt;</th></tr>
</thead>
<tbody>
    <tr><td></td><td>flightsview</td><td>TRUE</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">sparkR.stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<p><strong>Limpieza</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="nf">systemp</span><span class="p">(</span><span class="s">&#39;hdfs dfs -rm /tmp/flights.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Deleted /tmp/flights.csv
</pre></div></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Juan D. Velasquez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>